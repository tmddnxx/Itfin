!async function(){await afc.import("Framework/stock/component/ChartView.js"),(MultiChartView=class extends ChartView{constructor(){super(),this.frwName="stock",this.selectedIndex=-1,this.firstItem=null,this.nextKeyArr=null,this.nextDateArr=null,this.realKeyArr=null,this.tempIndex=-1,this.isDivideChart=!1}}).CONTEXT={tag:'<div data-base="MultiChartView" data-class="MultiChartView" class="AView-Style"></div>',defStyle:{width:"400px",height:"200px"},events:["swipe","longtab","scroll","scrollleft","scrollright","scrolltop","scrollbottom","drop","dragstart","dragend"]},MultiChartView.prototype.loadChartLayout=function(){this.isMultiChart=!0,this.selectedIndex=-1,this.realKeyArr=["","","",""],this.nextDateArr=["","","",""],this.nextKeyArr=[0,0,0,0],this.tempIndex=-1,this.isDivideChart=!1,ChartView.prototype.loadChartLayout.call(this)},MultiChartView.prototype.setItemInfo=function(t){this.item=t,-1==this.selectedIndex&&this.unregisterRealOne(),this.mainKeyInfo={},this.mainKeyInfo["D1단축코드"]=t[0],this.mainKeyInfo["D1단축명"]=t[1],this.mainKeyInfo["D1시장분류코드"]=t[2],-1==this.selectedIndex?(this.tempIndex++,this.realKeyArr[this.tempIndex]=this.makeRealKey(t)):(this.tempIndex=-1,this.realKeyArr[this.selectedIndex]=this.makeRealKey(t),this.checkUnregisterReal())},MultiChartView.prototype.setSearchType=function(t,e,i){ChartView.prototype.setSearchType.call(this,t,e),i&&(this.resetBtnState(),1==t?(this.minBtn.setText(this.term),this.selectBtn=this.minBtn):2==t?(this.tickBtn.setText(this.term),this.selectBtn=this.tickBtn):(this.termBtn.setText(this.termMap2[this.term]),this.selectBtn=this.termBtn),this.selectBtn.addClass("BT_CO2_NOR"))},MultiChartView.prototype.makeRealKey=function(t){var e=parseInt(t[2],10)+"_";return 2==t[2]||4==t[2]||118==t[2]||167==t[2]?e+=parseInt(t[0],10):e+=t[0],e+"_"},MultiChartView.prototype.checkUnregisterReal=function(){var t,e=this;for(t in this.realData){for(var i=!1,a=0;a<e.realKeyArr.length;a++)if(e.realKeyArr[a]==t){i=!0;break}i||(theApp.infoNetManager.unregisterReal(e.realQueryName,[e.realData[t]],null,[e]),delete e.realData[t])}},MultiChartView.prototype.isExistRealKey=function(t){return this.realData.hasOwnProperty(t)},MultiChartView.prototype.unregisterRealOne=function(){this.mainKeyInfo&&theApp.infoNetManager.unregisterReal(this.realQueryName,[this.mainKeyInfo],null,[this])},MultiChartView.prototype.unregisterReal=function(){var t,e=this;for(t in this.realData)theApp.infoNetManager.unregisterReal(e.realQueryName,[e.realData[t]],null,[e]);this.realData=new Object},MultiChartView.prototype.setFixedData=function(t,e){for(var i in e=e||this.makeRealKey(this.item),this.realData[e]||(this.realData[e]=new Object),t)this.realData[e][i]=t[i]},MultiChartView.prototype.setSearchData=function(t,e){for(var i in e=e||this.makeRealKey(this.item),this.realData[e]||(this.realData[e]=new Object),t)this.realData[e][i]=t[i]},MultiChartView.prototype.updateOutputData=function(t,e){afc.isSimulator||(ChartManager.updateOutputData([this.getElementId(),{ref:this.realData[e],data:t}]),this.isInit)||(this.tempData=t)},MultiChartView.prototype.updateRealData=function(t){var e,i;this.realData[t]&&""!=$.trim(this.realData[t])&&this.realData[t].key&&(e=this.realData[t].key.split("_"),this.realData[t]["D1단축코드"]!=(i=e?e[1]:i)||afc.isSimulator||ChartManager.updateRealData([this.getElementId(),this.realData[t]]))},MultiChartView.prototype.onRequestData=function(t,e){this.selectedIndex=e,ChartView.prototype.onRequestData.call(this,t,e)},MultiChartView.prototype.sendDataManage=function(){var a=this;this.getContainer().sendData(this.realQueryName,function(t,e){var i=t.getBlockData("InBlock1");i[0]=a.mainKeyInfo,a.isExistRealKey(a.makeRealKey([a.mainKeyInfo["D1단축코드"],"",a.mainKeyInfo["D1시장분류코드"]]))||(this.registerReal(a.realQueryName,i,null,[a],0),t.enableFlag("realFlag"))},function(t,e){t&&0<(t=t.getBlockData("OutBlock1")).length&&(a.setFixedData({"D1에러여부":!1,"D1초기화여부":!0,"D1수정주가여부":a.chartConfig.useAdPrice,"D1데이터개수":a.chartConfig.limitCnt,"D1단축코드":a.item[0],"D1종목명":a.item[1],"D1시장분류코드":a.item[2],"D1가격소수점자리수":a.midRoundMap[MasterInfo.formatMarketCode(a.item[2])]?a.midRoundMap[MasterInfo.formatMarketCode(a.item[2])]:0},t[0].key),a.sendChartData(0))})},MultiChartView.prototype.setDefaultAndMore=function(t){var e=null,e=-1<this.selectedIndex?this.realKeyArr[this.selectedIndex]:this.realKeyArr[this.tempIndex];t?this.setFixedData({"D1초기화여부":!1,"D1연속여부":t},e):(this.setFixedData({"D1초기화여부":!0,"D1연속여부":t},e),this.nextKey=0,this.nextDate="")},MultiChartView.prototype.onChangeAdjustedStock=function(t){var e="001"==this.mainKeyInfo["D1시장분류코드"]||"003"==this.mainKeyInfo["D1시장분류코드"],e=(this.chartConfig.useAdPrice=1==(t=e?t:!1)||"1"==t?1:0,this.saveConfigInfo(),null),e=-1<this.selectedIndex?this.realKeyArr[this.selectedIndex]:this.realKeyArr[this.tempIndex];this.setFixedData({"D1수정주가여부":this.chartConfig.useAdPrice},e),this.sendChartData(0)},MultiChartView.prototype.sendChartData=function(t){-1<this.selectedIndex?(this.nextKey=this.nextKeyArr[this.selectedIndex],this.nextDate=this.nextDateArr[this.selectedIndex],0==this.selectedIndex&&(this.firstItem=[this.item,this.searchType,this.term])):(this.nextKey=this.nextKeyArr[this.tempIndex],this.nextDate=this.nextDateArr[this.tempIndex],this.firstItem=[this.item,this.searchType,this.term]),ChartView.prototype.sendChartData.call(this,t)},MultiChartView.prototype.onDivideChart=function(t,e,i,a){this.isDivideChart=!0;var s=i.split(";"),r=a.split(";"),n=s.length-1;this.realKeyArr=new Array;for(var h=0;h<n;h++)s[h]?this.realKeyArr.push(this.makeRealKey([s[h],"",r[h]])):this.realKeyArr.push(new Array);this.checkUnregisterReal()},MultiChartView.prototype.onSelectedChart=function(t,e){if(this.isDivideChart)this.noSend=!1;else{if(this.selectedIndex==t-1)return;this.noSend=!0}this.selectedIndex=t-1,this.onRequestData(e.split(";"),this.selectedIndex),this.isDivideChart=!1},MultiChartView.prototype.onRequestCodeControl=function(t){this.selectedIndex=t-1;t=null;(t=Define.PRJ_TYPE==Define.MC?AWindow.createWindow("MC/window/MC0102.lay","MS0107"):AWindow.createWindow("MS/window/MS0107.lay","MS0107")).popupMode=!0,t.selIdx=this.selectedIndex,t.open(this,0,0,"100%","100%")},MultiChartView.prototype.setData=function(t){t&&0!=t.length?(t[0].key&&(realKey=t[0].key),this.isInit?(this.tempData=null,this.updateOutputData(t,realKey)):this.tempData=t):this.clearChart()},MultiChartView.prototype.setQueryData=function(t,e,i){var a,s=null,r=i.getQueryName();if(r==this.realQueryName){if(t&&0!=t.length)if(t[0].key&&(s=t[0].key),a=t[0],i.isReal){var n=this.realData[s];if(n){for(var h in a)n.hasOwnProperty(h)&&(n[h]=a[h]);this.updateRealData(s)}}else t[0].key&&this.setSearchData(a,t[0].key)}else"QR000002"!=r&&"QR000003"!=r&&"QR000004"!=r&&"QR000006"!=r&&"QR000015"!=r||(t&&0!=t.length?(t[0].key&&(s=t[0].key),this.isInit?(this.tempData=null,this.updateOutputData(t,s)):this.tempData=t):this.clearChart())},MultiChartView.prototype.onWindowResult=function(t,e){var i=this;if("MS0107"==e.getId())t&&(Define.PRJ_TYPE==Define.MC?theApp.menuInfo.isChartAvailable(e.resultData,this.getContainer().getId())?-1<e.resultData[0].indexOf("KTB")?this.onConnSendQuery("CP877500",e.resultData,function(t){t&&(e.resultData[0]=t["D1단축코드"],i.onRequestData([e.resultData[0],e.resultData[1],e.resultData[2],0,i.term],e.selIdx))}):this.onRequestData([e.resultData[0],e.resultData[1],e.resultData[2],0,this.term],e.selIdx):ChartManager.toast("추가할 수 없는 종목입니다."):0==theApp.menuInfo.isDifPageByCntId(e.resultData,this.getContainer().getId())[0]?this.onRequestData([e.resultData[0],e.resultData[1],e.resultData[2],0,this.term],e.selIdx):ChartManager.toast("추가할 수 없는 종목입니다."));else if("MS000002"==e.getId()&&null!=t){var a,s=this.clickBtn.getComponentId();if("MinBtn"!=s&&"TickBtn"!=s||!this.isFIndex(this.item)&&!this.isBIndex(this.item)){switch(this.resetBtnState(),s){case"MinBtn":this.setSearchType(1,t),this.setLastValue(t),a=this.clickBtn;break;case"TickBtn":this.setSearchType(2,t),this.setLastValue(t),a=this.clickBtn;break;case"TermBtn":this.setSearchType(0,this.termMap[t]),this.setLastValue(this.termMap[t]),a=this.clickBtn;break;case"MinBtn2":-1<$.inArray(t,["일","주","월","년"])?(this.setSearchType(0,this.termMap[t]),this.setLastValue(this.termMap[t]),this.termBtn&&this.termBtn.setText(t),this.tickBtn2.setText("1"),this.tickBtn2.$ele.hide(),a=this.clickBtn):"분"==t?(this.tickBtn2.$ele.show(),this.minBtn&&this.minBtn.setText("1"),this.setSearchType(1,"1"),this.setLastValue("1"),a=this.tickBtn2):"틱"==t&&(this.tickBtn2.$ele.show(),this.tickBtn&&this.tickBtn.setText("1"),this.setSearchType(2,"1"),this.setLastValue("1"),a=this.tickBtn2);break;case"TickBtn2":1==this.getSearchType()[0]?(this.termBtn2.setText("분"),this.minBtn&&this.minBtn.setText(t),this.setSearchType(1,t),this.setLastValue(t),a=this.clickBtn):2==this.getSearchType()[0]&&(this.termBtn2.setText("틱"),this.tickBtn&&this.tickBtn.setText(t),this.setSearchType(2,t),this.setLastValue(t),a=this.clickBtn)}this.clickBtn.setText(t),this.selectBtn=a,this.selectBtn.addClass("BT_CO2_NOR"),this.sendDataManage()}else ChartManager.toast("조회할 수 없는 종목입니다.")}},MultiChartView.prototype.onConnSendQuery=function(t,i,a){this.getContainer().sendData(t,function(t,e){"KTBSI10"==i[0]&&(i[0]="KTBI10"),t.getBlockData("InBlock1")[0]={"D1시장분류코드":161,"D1단축코드":i[0]},t.getBlockData("InBlock3")[0]={"D1metrix의갯수":1}},function(t,e){t&&null!=(t=t.getBlockData("OutBlock1")[0])&&a({"D1단축코드":t["D1국제표준코드"]})})}}();