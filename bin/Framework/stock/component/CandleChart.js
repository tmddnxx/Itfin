!async function(){await afc.import("Framework/stock/component/BaseChart.js"),(CandleChart=class CandleChart extends BaseChart{static INTERVALS_MONTH=0;static INTERVALS_WEEK=1;static INTERVALS_DAY=2;static INTERVALS_MINUTE=5;static INTERVALS_TICK=7;static INDICATOR_VOLUME=0;static INDICATOR_OBV=1;static INDICATOR_MACD=2;static INDICATOR_SLOW=3;static INDICATOR_FAST=4;static INDICATOR_DISPARITY=5;static INDICATOR_RSI=6;static INDICATOR_EMPTY=7;static INDEX_OPEN=1;static INDEX_HIGH=2;static INDEX_LOW=3;static INDEX_CLOSE=4;static INDEX_QTY=5;constructor(){super(),this.frwName="stock",this.delegator=null,this.preScale=1,this.rateVal=1,this.zoomState=0,this.lastDist=0,this.scollSX=0,this.scollEX=0,this.speed=10,this.upEndDegree=13,this.dotDegree=[1,4,7,10],this.mStartTime=0,this.mOldTime=0,this.mStartX=0,this.mEndX=0,this.mScrollLR=!1,this.timer=null,this.offset=0,this.startIdx=0,this.startLineX=0,this.endIdx=0,this.BAR_CNT=50,this.subType=0,this.indicator=0,this.prdCls=0,this.intervals=CandleChart.INTERVALS_MONTH,this.dateformatFunc=[afc.formatMonth,afc.formatDate,afc.formatDate,null,null,afc.formatTime,null,afc.formatTime],this.dateformat=this.dateformatFunc[this.intervals],this.dashType=[1.5,4],this.TEXT_SIZE="16px",this.MIN_TEXT_SIZE=16,this.defColorObj={BACK:StockColor.BACK,TEXT:StockColor.TEXT,DOT:StockColor.DOT,DIVLINE:StockColor.DIVLINE,UP:StockColor.UP_COLOR,DOWN:StockColor.DOWN_COLOR,UPBG:StockColor.LAST[1],DOWNBG:StockColor.LAST[2],UPTEXT:StockColor.TEXT_CURR,DOWNTEXT:StockColor.TEXT_CURR,VOLUME:StockColor.VOLUME,LINE:StockColor.CANDLE_LINE},this.colorObj={BACK:StockColor.BACK,TEXT:StockColor.TEXT,DOT:StockColor.DOT,DIVLINE:StockColor.DIVLINE,UP:StockColor.UP_COLOR,DOWN:StockColor.DOWN_COLOR,UPBG:StockColor.LAST[1],DOWNBG:StockColor.LAST[2],UPTEXT:StockColor.TEXT_CURR,DOWNTEXT:StockColor.TEXT_CURR,VOLUME:StockColor.VOLUME,LINE:StockColor.CANDLE_LINE},this.maKeyArr=new Array(5,20,60),this.maKeyLen=3,this.COLOR_ARR=[this.colorObj.DOWN,this.colorObj.UP,this.colorObj.DOWN],this.CURRENT_BGCOLOR_ARR=[this.colorObj.DOWNBG,this.colorObj.UPBG,this.colorObj.DOWNBG],this.CURRENT_COLOR_ARR=[this.colorObj.DOWNTEXT,this.colorObj.UPTEXT,this.colorObj.DOWNTEXT],this.TEXT_SET=["MA5","MA20","MA60"],this.COLOR_SET=StockColor.SUB_COLORS[0],this.SUB_TEXT_SET=[["MA5","MA20","MA60"],["OBV"],["MACD(12,26)","Signal(9)"],["Slow%K(5,3)","Slow%D(3)"],["Fast K(5)","Fast D(3)"],["이격도(10)"],["RSI(12)","Signal"]],this.SUB_COLOR_SET=StockColor.SUB_COLORS,this.touchEvent=null,this.isFirst=!0,this.ROW_CNT=20,this.AM_R_WIDTH=100,this.AM_L_WIDTH=0,this.MAX_BAR_W=80,this.DEF_BAR_W=8,this.MIN_BAR_W=8,this.BAR_TERM=1,this.upGrpMaxAm=0,this.upGrpMinAm=0,this.dwGrpMaxAm=0,this.dwGrpMinAm=0,this.pos={cavasW:0,cavasH:0,grpW:0,grpEX:0,dtXs:[],amYs:[],amPad:0,txtY:0,upGrpSY:0,upDtY:0,upGrpEY:0,upGrpH:0,kbnY:0,dwGrpSY:0,dwDtY:0,dwGrpEY:0,dwGrpH:0,dw80Y:0,dw20Y:0,upRateH:0,dwRateH:0,barW:this.DEF_BAR_W,barTot:0},this.drawBackType=null,this.drawTextType=null,this.drawChartType=null,this.drawSubGrpFuncs=[[this.drawBackType0,this.drawTextType0,this.drawMaxMinType0,this.drawChartType0,this.calcMaxMinChartType0],[this.drawBackType1,this.drawTextType1,this.drawMaxMinType1,this.drawChartType1,this.calcMaxMinChartType1],[this.drawBackType2,this.drawTextType2,this.drawMaxMinType2,this.drawChartType2,this.calcMaxMinChartType2],[this.drawBackType3,this.drawTextType3,this.drawMaxMinType3,this.drawChartType3,this.calcMaxMinChartType3],[this.drawBackType4,this.drawTextType4,this.drawMaxMinType4,this.drawChartType4,this.calcMaxMinChartType4],[this.drawBackType5,this.drawTextType5,this.drawMaxMinType5,this.drawChartType5,this.calcMaxMinChartType5],[this.drawBackType6,this.drawTextType6,this.drawMaxMinType6,this.drawChartType6,this.calcMaxMinChartType6],[this.drawBackType7,this.drawTextType7,this.drawMaxMinType7,this.drawChartType7,this.calcMaxMinChartType7]],this.drawBackType=this.drawSubGrpFuncs[this.indicator][0],this.drawTextType=this.drawSubGrpFuncs[this.indicator][1],this.drawMaxMinType=this.drawSubGrpFuncs[this.indicator][2],this.drawChartType=this.drawSubGrpFuncs[this.indicator][3],this.calcMaxMinChartType=this.drawSubGrpFuncs[this.indicator][4],this.compLeft=0,this.middleX=0,this.currentTickCount=0}}).CONTEXT={tag:'<div data-base="CandleChart" data-class="CandleChart" class="CandleChart-Style" >            <canvas width="640px" height="400px"></canvas>\t        <div class="chart-vline" style="display: none;"></div>\t\t\t<div class="chart-hline" style="display: none;"></div>\t\t\t<div class="chart-zoomLay"><div class="chart-zoomIn" >+</div><div class="chart-zoomOut">-</div></div>\t\t\t<div class="chart-info" style="display: none;"></div>\t\t</div>',defStyle:{width:"640px",height:"400px"},events:["scrollleft"]},CandleChart.prototype.init=function(t,s){BaseChart.prototype.init.call(this,t,s),this.isFirst=!0,this.longXdiv=this.element.children[1],this.longYdiv=this.element.children[2],this.zoomDiv=this.element.children[3],this.zoomInDiv=this.zoomDiv.children[0],this.zoomOutDiv=this.zoomDiv.children[1],this.infoDiv=this.element.children[4],this.setOption({touchEvent:"false"!=this.getAttr("data-touch-event")},!0),this.setMode(this.getAttr("data-mode")||0),this.setIntervals(this.getAttr("data-intervals")||CandleChart.INTERVALS_MONTH),this.setIndicator(this.getAttr("data-indicator")||CandleChart.INDICATOR_VOLUME),this.setUpdateRefVal(this.getAttr("data-updaterefvalue")),this.initEvent()},CandleChart.prototype.extractColorObj=function(){BaseChart.prototype.extractColorObj.call(this),this.COLOR_ARR=[this.colorObj.DOWN,this.colorObj.UP,this.colorObj.DOWN],this.CURRENT_BGCOLOR_ARR=[this.colorObj.DOWNBG,this.colorObj.UPBG,this.colorObj.DOWNBG],this.CURRENT_COLOR_ARR=[this.colorObj.DOWNTEXT,this.colorObj.UPTEXT,this.colorObj.DOWNTEXT]},CandleChart.prototype.initEvent=function(){this.option.touchEvent?(this.setTouchEvent(),this.setZoomEvent()):(this.zoomDiv.style.display="none",this.setLongTabEvent())},CandleChart.prototype.changeBtnStyle=function(t,s){t&&($(this.zoomInDiv).removeClass("chart-zoomIn"),$(this.zoomInDiv).addClass(t)),s&&($(this.zoomOutDiv).removeClass("chart-zoomOut"),$(this.zoomOutDiv).addClass(s))},CandleChart.prototype.updatePosition=function(t,s){this.isShow()&&(BaseChart.prototype.updatePosition.call(this,t,s),this.calcPosition(this.eleW,this.eleH),this.data)&&this.updateGraph()},CandleChart.prototype.setZoomEvent=function(t,s){var i=this,a=this.zoomInDiv,h=this.zoomOutDiv;t&&(a=t.element),s&&(h=s.element),$(a).bind(AEvent.ACTION_UP,function(t){i.data&&0!=i.data.length&&(1!=i.zoomState&&(i.rateVal=1,i.zoomState=1),i.rateVal=parseFloat(i.rateVal)+.01,i.zoomInOut())}),$(h).bind(AEvent.ACTION_UP,function(t){i.data&&0!=i.data.length&&(2!=i.zoomState&&(i.rateVal=1,i.zoomState=2),i.rateVal=parseFloat(i.rateVal)-.01,i.zoomInOut())})},CandleChart.prototype.setDelegator=function(t){this.delegator=t},CandleChart.prototype.setMAInfo=function(t,s){this.maKeyArr=t,this.maKeyLen=this.maKeyArr.length,this.TEXT_SET=new Array(this.maKeyLen),this.SUB_TEXT_SET[0]=new Array(this.maKeyLen);for(var i=0;i<t.length;i++)this.TEXT_SET[i]="MA"+this.maKeyArr[i],this.SUB_TEXT_SET[0][i]="MA"+this.maKeyArr[i];if(s)this.COLOR_SET=s,this.SUB_COLOR_SET[0]=s;else{this.COLOR_SET=new Array(this.maKeyLen);for(var a,i=0;i<t.length;i++)a=afc.getRandomColor(),this.COLOR_SET[i]=a,this.SUB_COLOR_SET[0][i]=a}},CandleChart.prototype.calcPosition=function(t,s){this.pos.cavasW=t,this.pos.cavasH=s,this.pos.grpEX=t-this.AM_R_WIDTH,this.pos.grpW=this.pos.grpEX-this.AM_L_WIDTH,this.pos.amPad=t-5,this.pos.dtXs=[this.AM_L_WIDTH+.25*this.pos.grpW,this.AM_L_WIDTH+.5*this.pos.grpW,this.AM_L_WIDTH+.75*this.pos.grpW],this.pos.upGrpSY=s/this.ROW_CNT,this.pos.txtY=this.pos.upGrpSY/2,this.pos.upGrpEY=this.pos.upGrpSY*this.upEndDegree,this.pos.upGrpH=this.pos.upGrpEY-this.pos.upGrpSY,this.pos.upDtY=this.pos.upGrpEY+this.pos.txtY,this.pos.amYs=[this.pos.upGrpSY*this.dotDegree[0],this.pos.upGrpSY*this.dotDegree[1],this.pos.upGrpSY*this.dotDegree[2],this.pos.upGrpSY*this.dotDegree[3],this.pos.upGrpEY],this.pos.kbnY=14*this.pos.upGrpSY,this.pos.dwGrpSY=15*this.pos.upGrpSY,this.pos.dwGrpEY=19*this.pos.upGrpSY,this.pos.dwDtY=this.pos.dwGrpEY+this.pos.txtY,this.pos.dwGrpH=this.pos.dwGrpEY-this.pos.dwGrpSY,this.pos.dw80Y=this.pos.dwGrpSY+.2*this.pos.dwGrpH,this.pos.dw20Y=this.pos.dwGrpSY+.8*this.pos.dwGrpH,this.TEXT_SIZE=t<s?.03*this.pos.cavasW:.03*this.pos.cavasH,this.TEXT_SIZE<this.MIN_TEXT_SIZE&&(this.TEXT_SIZE=this.MIN_TEXT_SIZE),this.TEXT_SIZE+="px",this.reCalcWidth(),this.startLineX=this.pos.grpEX+this.pos.barW/2,this.settingDrawIndicator()},CandleChart.prototype.reCalcWidth=function(t){t&&(this.BAR_CNT=t),this.pos.barTot=this.pos.grpW/this.BAR_CNT,this.pos.barW=this.pos.barTot-this.BAR_TERM},CandleChart.prototype.setData=function(t,i){var s;this.resetData(),0==t.length?AToast.show("데이터가 존재하지 않습니다."):(i||(s=t[0],"[object Array]"==Object.prototype.toString.call(s)?(i=[],s.forEach(function(t,s){i.push(s)})):i=Object.keys(s)),this.makeChartCanvasData(t,i),this.updateGraph())},CandleChart.prototype.setIsFirst=function(t){this.isFirst=t},CandleChart.prototype.getIsFirst=function(){return this.isFirst},CandleChart.prototype.setPrdCls=function(t){this.setIntervals(t)},CandleChart.prototype.getIntervals=function(){return this.intervals},CandleChart.prototype.setIntervals=function(t,s){this.intervals=t;var i=this.dateformatFunc[this.intervals];"string"==typeof i?(this.dateformat=ADataMask.getFunc("format"),this.dateParam=i):(this.dateformat=i,this.dateParam=null),s||this.updateGraph(),this.setAttr("data-intervals",t)},CandleChart.prototype.setUpdateRefVal=function(t){null!=t&&(this.updateRefVal=t)},CandleChart.prototype.setDateformatFunc=function(t,s){this.dateformatFunc[t]=s,this.setIntervals(this.intervals)},CandleChart.prototype.getIndicator=function(){return this.indicator},CandleChart.prototype.setIndicator=function(t,s){this.indicator=t,this.settingDrawIndicator(),7==t?(this.upEndDegree=19,this.dotDegree=[1,6,12,18]):(this.dotDegree=[1,4,7,10],this.upEndDegree=13),this.calcPosition(this.eleW,this.eleH),s||this.updateGraph(),this.setAttr("data-indicator",t)},CandleChart.prototype.setSubGrpType=function(t,s){this.setIndicator(t,!s)},CandleChart.prototype.settingDrawSubGrp=function(){this.settingDrawIndicator()},CandleChart.prototype.settingDrawIndicator=function(){var t=this.drawSubGrpFuncs[this.indicator];this.drawBackType=t[0],this.drawTextType=t[1],this.drawMaxMinType=t[2],this.drawChartType=t[3],this.calcMaxMinChartType=t[4]},CandleChart.prototype.getData=function(){return this.data},CandleChart.prototype.resetData=function(){this.preScale=1,this.rateVal=1,this.zoomState=0,this.lastDist=0,this.scollSX=0,this.scollEX=0,this.speed=0,this.mStartTime=0,this.mOldTime=0,this.mStartX=0,this.mEndX=0,this.mScrollLR=!1,this.timer=null,this.offset=0,this.startIdx=0,this.endIdx=0,this.reCalcWidth(),this.isFirst=!0,this.upGrpMaxAm=0,this.upGrpMinAm=0,this.dwGrpMaxAm=0,this.dwGrpMinAm=0,this.nextIqryDate="",this.data=[],this.upDownArr=[],this.macdDataArr=[],this.dptDataArr=[],this.obvDataArr=[],this.rsiDataArr=[],this.stkDataArr=[],this.rsiUp=[],this.rsiDw=[],this.topMaTotalArr=new Array(this.maKeyLen),this.topMaxMinArr=[],this.btmMaxMinArr=[],this.bottomMaTotalArr=new Array(this.maKeyLen);for(var t=0;t<this.maKeyLen;t++)this.topMaTotalArr[t]=0,this.bottomMaTotalArr[t]=0;this.rsiTotalUp=0,this.rsiTotalDw=0,this.dispTotal=0,this.topMaArr=[],this.bottomMaArr=[];for(t=0;t<this.maKeyLen;t++)this.topMaArr[t]=[],this.bottomMaArr[t]=[];this.ctx.clearRect(0,0,this.pos.cavasW,this.pos.cavasH),this.drawBackLine()},CandleChart.prototype.draw=function(){this.ctx.clearRect(0,0,this.pos.cavasW,this.pos.cavasH),this.ctx.font=this.TEXT_SIZE+" '"+this.FONT_FAMILY+"'",this.ctx.textBaseline="middle",this.drawBackLine(),this.drawBackText(),this.drawGraph()},CandleChart.prototype.drawBackLine=function(){this.ctx.beginPath(),this.ctx.lineWidth=1.5,this.ctx.strokeStyle=this.colorObj.DOT;for(var t=0;t<5;t++)this.drawDashedLine(this.AM_L_WIDTH+0,this.pos.amYs[t],this.pos.grpEX,this.pos.amYs[t],this.dashType);for(t=0;t<3;t++)this.drawDashedLine(this.pos.dtXs[t]-1,0,this.pos.dtXs[t],this.pos.dwGrpEY,this.dashType);this.drawBackType(),this.ctx.stroke(),this.ctx.closePath(),7!=this.indicator&&(this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.strokeStyle=this.colorObj.DIVLINE,this.ctx.moveTo(0,this.pos.kbnY),this.ctx.lineTo(this.pos.cavasW,this.pos.kbnY),this.ctx.stroke(),this.ctx.closePath()),this.ctx.beginPath(),this.ctx.moveTo(this.pos.grpEX,0),this.ctx.lineTo(this.pos.grpEX,this.pos.cavasH),this.ctx.stroke(),this.ctx.closePath()},CandleChart.prototype.drawBackText=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.txtY,this.TEXT_SET,this.COLOR_SET),this.drawTextType()},CandleChart.prototype.setMaxMin=function(){this.upGrpMaxAm=0,this.upGrpMinAm=Number.MAX_VALUE,this.dwGrpMaxAm=0,this.dwGrpMinAm=Number.MAX_VALUE;for(var t,s=this.startIdx;s<this.endIdx;s++)t=this.topMaxMinArr[s],this.upGrpMaxAm=Math.max(this.upGrpMaxAm,t[0]),this.upGrpMinAm=Math.min(this.upGrpMinAm,t[1]),this.calcMaxMinChartType(s);this.upGrpMaxAm==this.upGrpMinAm&&(this.upGrpMinAm=0),this.dwGrpMaxAm==this.dwGrpMinAm&&(this.dwGrpMinAm=0),this.pos.upRateH=(this.pos.upGrpEY-this.pos.upGrpSY)/(this.upGrpMaxAm-this.upGrpMinAm),this.pos.dwRateH=(this.pos.dwGrpEY-this.pos.dwGrpSY)/(this.dwGrpMaxAm-this.dwGrpMinAm)},CandleChart.prototype.drawGraph=function(){if(this.data&&0!=this.data.length){var t,s,i,a,h=this.data,r=this.startLineX,e=[],o=[];if(1==this.mode){e.push({x:null,y:null});for(var p=0;p<this.maKeyLen;p++)o.push({x:null,y:null})}else for(p=0;p<this.maKeyLen;p++)e.push({x:null,y:null}),o.push({x:null,y:null});this.ctx.fillStyle=this.colorObj.TEXT,this.ctx.textAlign="center";var n=h[parseInt(.75*this.BAR_CNT)+this.startIdx],d=h[parseInt(.5*this.BAR_CNT)+this.startIdx],l=h[parseInt(.25*this.BAR_CNT)+this.startIdx];n&&this.ctx.fillText(this.dateformat(n[0],this.dateParam),this.pos.dtXs[0],this.pos.dwDtY),d&&this.ctx.fillText(this.dateformat(d[0],this.dateParam),this.pos.dtXs[1],this.pos.dwDtY),l&&this.ctx.fillText(this.dateformat(l[0],this.dateParam),this.pos.dtXs[2],this.pos.dwDtY),this.ctx.textAlign="right",this.ctx.fillText(this._getDecimalValue(this.upGrpMaxAm),this.pos.amPad,this.pos.amYs[0]),this.ctx.fillText(this._getDecimalValue(this.upGrpMaxAm-.25*(this.upGrpMaxAm-this.upGrpMinAm)),this.pos.amPad,this.pos.amYs[1]),this.ctx.fillText(this._getDecimalValue(this.upGrpMaxAm-.5*(this.upGrpMaxAm-this.upGrpMinAm)),this.pos.amPad,this.pos.amYs[2]),this.ctx.fillText(this._getDecimalValue(this.upGrpMaxAm-.75*(this.upGrpMaxAm-this.upGrpMinAm)),this.pos.amPad,this.pos.amYs[3]),this.ctx.fillText(this._getDecimalValue(this.upGrpMinAm),this.pos.amPad,this.pos.amYs[4]),this.drawMaxMinType();for(p=this.startIdx;p<this.endIdx;p++){if(t=h[p],r-=this.pos.barTot,1==this.mode)this.drawAvgLine(this.colorObj.LINE,e[0],r,this.pos.upGrpSY+(this.upGrpMaxAm-t[CandleChart.INDEX_CLOSE])*this.pos.upRateH);else{s=this.pos.upGrpSY+Math.abs(this.upGrpMaxAm-t[CandleChart.INDEX_HIGH])*this.pos.upRateH,this.ctx.beginPath(),this.ctx.lineWidth=this.pos.barW,this.ctx.strokeStyle=this.COLOR_ARR[this.upDownArr[p][0]],this.ctx.moveTo(r,this.pos.upGrpSY+(this.upGrpMaxAm-t[CandleChart.INDEX_OPEN])*this.pos.upRateH),i=this.pos.upGrpSY+(this.upGrpMaxAm-t[CandleChart.INDEX_CLOSE])*this.pos.upRateH,this.ctx.lineTo(r,i+this.upDownArr[p][1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.lineWidth="1.5",this.ctx.moveTo(r,s),this.ctx.lineTo(r,s+Math.abs(t[CandleChart.INDEX_HIGH]-t[CandleChart.INDEX_LOW])*this.pos.upRateH),this.ctx.stroke(),this.ctx.closePath();for(var c=0;c<this.maKeyLen;c++)a=this.topMaArr[c][p],this.drawAvgLine(a[0],e[c],r,this.pos.upGrpSY+(this.upGrpMaxAm-a[1])*this.pos.upRateH)}this.drawChartType(p,o,r)}this.ctx.strokeStyle=this.CURRENT_BGCOLOR_ARR[this.upDownArr[this.startIdx][0]],n=this.pos.upGrpSY+(this.upGrpMaxAm-h[this.startIdx][CandleChart.INDEX_CLOSE])*this.pos.upRateH,this.ctx.beginPath(),this.ctx.lineWidth=this.pos.upGrpSY,this.ctx.moveTo(this.pos.grpEX+1,n),this.ctx.lineTo(this.pos.cavasW,n),this.ctx.stroke(),this.ctx.closePath(),this.ctx.textAlign="right",this.ctx.fillStyle=this.CURRENT_COLOR_ARR[this.upDownArr[this.startIdx][0]],this.ctx.fillText(this._getDecimalValue(h[this.startIdx][CandleChart.INDEX_CLOSE]),this.pos.amPad,n)}},CandleChart.prototype.drawAvgLine=function(t,s,i,a){this.ctx.beginPath(),this.ctx.strokeStyle=t,null==s.x&&(s.x=i,s.y=a),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(i,a),s.x=i,s.y=a,this.ctx.stroke(),this.ctx.closePath()},CandleChart.prototype.drawSubLine=function(t,s,i,a){this.ctx.beginPath(),this.ctx.strokeStyle=t,null==s.x&&(s.x=i,s.y=a),this.ctx.moveTo(s.x,s.y),this.ctx.lineTo(i,a),s.x=i,s.y=a,this.ctx.stroke(),this.ctx.closePath()},CandleChart.prototype.setBackLineColor=function(t,s){this.colorObj.DOT=t,s&&this.updatePosition($(this.element).width(),$(this.element).height())},CandleChart.prototype.setTextColor=function(t,s){this.colorObj.TEXT=t,s&&this.updatePosition($(this.element).width(),$(this.element).height())},CandleChart.prototype.setUpColor=function(t,s){this.colorObj.UP=t,s&&this.updatePosition($(this.element).width(),$(this.element).height())},CandleChart.prototype.setDownColor=function(t,s){this.colorObj.DOWN=t,s&&this.updatePosition($(this.element).width(),$(this.element).height())},CandleChart.prototype._drawLegend=function(t,s,i,a,h){var r="",e=t;this.ctx.textAlign="left";for(var o=0;o<a.length;o++)e+=this.ctx.measureText(r).width+s,r=a[o],this.ctx.fillStyle=h[o],this.ctx.fillText(r,e,i)},CandleChart.prototype.drawBackType0=function(){this.drawDashedLine(this.AM_L_WIDTH+0,this.pos.dwGrpSY,this.pos.grpEX,this.pos.dwGrpSY,this.dashType),this.drawDashedLine(this.AM_L_WIDTH+0,this.pos.dwGrpEY,this.pos.grpEX,this.pos.dwGrpEY,this.dashType)},CandleChart.prototype.drawTextType0=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.TEXT_SET,this.COLOR_SET)},CandleChart.prototype.drawMaxMinType0=function(){this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMaxAm)),this.pos.amPad,this.pos.dwGrpSY),this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMinAm)),this.pos.amPad,this.pos.dwGrpEY)},CandleChart.prototype.drawChartType0=function(t,s,i){this.ctx.strokeStyle=this.colorObj.VOLUME,this.ctx.beginPath(),this.ctx.lineWidth=this.pos.barW,this.ctx.moveTo(i,this.pos.dwGrpSY+(this.dwGrpMaxAm-this.data[t][CandleChart.INDEX_QTY])*this.pos.dwRateH),this.ctx.lineTo(i,this.pos.dwGrpEY),this.ctx.stroke(),this.ctx.closePath(),this.ctx.lineWidth="1.5";for(var a,h=0;h<this.maKeyLen;h++)a=this.bottomMaArr[h][t],this.drawSubLine(a[0],s[h],i,this.pos.dwGrpSY+(this.dwGrpMaxAm-a[1])*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType0=function(t){this.dwGrpMaxAm=Math.max(this.dwGrpMaxAm,this.btmMaxMinArr[t][0]),this.dwGrpMinAm=Math.min(this.dwGrpMinAm,this.btmMaxMinArr[t][1])},CandleChart.prototype.drawBackType1=function(){},CandleChart.prototype.drawTextType1=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.SUB_TEXT_SET[this.indicator],this.SUB_COLOR_SET[this.indicator])},CandleChart.prototype.drawMaxMinType1=function(){this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMaxAm)),this.pos.amPad,this.pos.dwGrpSY),this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMinAm)),this.pos.amPad,this.pos.dwGrpEY)},CandleChart.prototype.drawChartType1=function(t,s,i){this.drawSubLine(this.SUB_COLOR_SET[this.indicator][0],s[0],i,this.pos.dwGrpSY+(this.dwGrpMaxAm-this.obvDataArr[t])*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType1=function(t){this.dwGrpMaxAm=Math.max(this.dwGrpMaxAm,this.obvDataArr[t]),this.dwGrpMinAm=Math.min(this.dwGrpMinAm,this.obvDataArr[t])},CandleChart.prototype.drawBackType2=function(){this.drawDashedLine(this.AM_L_WIDTH+0,this.pos.dwGrpSY,this.pos.grpEX,this.pos.dwGrpSY,this.dashType),this.drawDashedLine(this.AM_L_WIDTH+0,this.pos.dwGrpEY,this.pos.grpEX,this.pos.dwGrpEY,this.dashType)},CandleChart.prototype.drawTextType2=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.SUB_TEXT_SET[this.indicator],this.SUB_COLOR_SET[this.indicator])},CandleChart.prototype.drawMaxMinType2=function(){this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMaxAm)),this.pos.amPad,this.pos.dwGrpSY),this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMinAm)),this.pos.amPad,this.pos.dwGrpEY)},CandleChart.prototype.drawChartType2=function(t,s,i){this.drawSubLine(this.SUB_COLOR_SET[this.indicator][0],s[0],i,this.pos.dwGrpSY+(this.dwGrpMaxAm-this.macdDataArr[t][0])*this.pos.dwRateH),this.drawSubLine(this.SUB_COLOR_SET[this.indicator][1],s[1],i,this.pos.dwGrpSY+(this.dwGrpMaxAm-this.macdDataArr[t][1])*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType2=function(t){var s=this.macdDataArr[t][0],t=this.macdDataArr[t][1];this.dwGrpMaxAm=Math.max(this.dwGrpMaxAm,s,t),this.dwGrpMinAm=Math.min(this.dwGrpMinAm,s,t)},CandleChart.prototype.drawBackType3=function(){this.drawDashedLine(0,this.pos.dw80Y,this.pos.grpEX,this.pos.dw80Y,this.dashType),this.drawDashedLine(0,this.pos.dw20Y,this.pos.grpEX,this.pos.dw20Y,this.dashType)},CandleChart.prototype.drawTextType3=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.SUB_TEXT_SET[this.indicator],this.SUB_COLOR_SET[this.indicator])},CandleChart.prototype.drawMaxMinType3=function(){this.ctx.fillText("80%",this.pos.amPad,this.pos.dw80Y),this.ctx.fillText("20%",this.pos.amPad,this.pos.dw20Y)},CandleChart.prototype.drawChartType3=function(t,s,i){this.drawSubLine(this.SUB_COLOR_SET[this.indicator][0],s[0],i,this.pos.dwGrpSY+(100-this.stkDataArr[t][1])/100*this.pos.dwRateH),this.drawSubLine(this.SUB_COLOR_SET[this.indicator][1],s[1],i,this.pos.dwGrpSY+(100-this.stkDataArr[t][2])/100*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType3=function(){this.dwGrpMaxAm=2,this.dwGrpMinAm=1},CandleChart.prototype.setChartMode=function(t,s){this.setIntervals(7),this.setMode(t,!s)},CandleChart.prototype.getMode=function(){return this.mode},CandleChart.prototype.setMode=function(t,s){this.mode=t,s||this.updateGraph(),this.setAttr("data-mode",t)},CandleChart.prototype.drawBackType4=function(){this.drawDashedLine(0,this.pos.dw80Y,this.pos.grpEX,this.pos.dw80Y,this.dashType),this.drawDashedLine(0,this.pos.dw20Y,this.pos.grpEX,this.pos.dw20Y,this.dashType)},CandleChart.prototype.drawTextType4=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.SUB_TEXT_SET[this.indicator],this.SUB_COLOR_SET[this.indicator])},CandleChart.prototype.drawMaxMinType4=function(){this.ctx.fillText("80%",this.pos.amPad,this.pos.dw80Y),this.ctx.fillText("20%",this.pos.amPad,this.pos.dw20Y)},CandleChart.prototype.drawChartType4=function(t,s,i){this.drawSubLine(this.SUB_COLOR_SET[this.indicator][0],s[0],i,this.pos.dwGrpSY+(100-this.stkDataArr[t][0])/100*this.pos.dwRateH),this.drawSubLine(this.SUB_COLOR_SET[this.indicator][1],s[1],i,this.pos.dwGrpSY+(100-this.stkDataArr[t][1])/100*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType4=function(){this.dwGrpMaxAm=2,this.dwGrpMinAm=1},CandleChart.prototype.drawBackType5=function(){},CandleChart.prototype.drawTextType5=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.SUB_TEXT_SET[this.indicator],this.SUB_COLOR_SET[this.indicator])},CandleChart.prototype.drawMaxMinType5=function(){this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMaxAm)),this.pos.amPad,this.pos.dwGrpSY),this.ctx.fillText(afc.addComma(parseInt(this.dwGrpMinAm)),this.pos.amPad,this.pos.dwGrpEY)},CandleChart.prototype.drawChartType5=function(t,s,i){this.drawSubLine(this.dptDataArr[t][0],s[0],i,this.pos.dwGrpSY+(this.dwGrpMaxAm-this.dptDataArr[t][1])*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType5=function(t){t=this.dptDataArr[t][1];this.dwGrpMaxAm=Math.max(this.dwGrpMaxAm,t),this.dwGrpMinAm=Math.min(this.dwGrpMinAm,t)},CandleChart.prototype.drawBackType6=function(){this.drawDashedLine(0,this.pos.dw80Y,this.pos.grpEX,this.pos.dw80Y,this.dashType),this.drawDashedLine(0,this.pos.dw20Y,this.pos.grpEX,this.pos.dw20Y,this.dashType)},CandleChart.prototype.drawTextType6=function(){this._drawLegend(this.AM_L_WIDTH,10,this.pos.kbnY+this.pos.txtY,this.SUB_TEXT_SET[this.indicator],this.SUB_COLOR_SET[this.indicator])},CandleChart.prototype.drawMaxMinType6=function(){this.ctx.fillText("80%",this.pos.amPad,this.pos.dw80Y),this.ctx.fillText("20%",this.pos.amPad,this.pos.dw20Y)},CandleChart.prototype.drawChartType6=function(t,s,i){this.drawSubLine(this.SUB_COLOR_SET[this.indicator][0],s[0],i,this.pos.dwGrpSY+(100-this.rsiDataArr[t][0])/100*this.pos.dwRateH),this.drawSubLine(this.SUB_COLOR_SET[this.indicator][1],s[1],i,this.pos.dwGrpSY+(100-this.rsiDataArr[t][1])/100*this.pos.dwRateH)},CandleChart.prototype.calcMaxMinChartType6=function(){this.dwGrpMaxAm=2,this.dwGrpMinAm=1},CandleChart.prototype.drawBackType7=function(){},CandleChart.prototype.drawTextType7=function(){},CandleChart.prototype.drawMaxMinType7=function(){},CandleChart.prototype.drawChartType7=function(t,s,i){},CandleChart.prototype.calcMaxMinChartType7=function(){},CandleChart.prototype.isExistNextData=function(){return!(this.startIdx+this.BAR_CNT>this.data.length)},CandleChart.prototype.getOffset=function(){var t=this.startIdx+this.BAR_CNT;t>this.data.length?this.endIdx=this.data.length:this.endIdx=t},CandleChart.prototype.barWidthChange=function(){this.pos.barTot=this.pos.barW+this.BAR_TERM,this.BAR_CNT=parseInt(this.pos.grpW/this.pos.barTot,10),this.startLineX=this.pos.grpEX+this.pos.barW/2},CandleChart.prototype.scrollLToR=function(t){this.isExistNextData()?(this.startIdx+=t,this.updateGraph()):(this.getOffset(),this.isReportedScrollLeft||(this.reportEvent("scrollleft"),this.isReportedScrollLeft=!0))},CandleChart.prototype.scrollRToL=function(t){this.data.length<1?this.getOffset():(this.isReportedScrollLeft=!1,this.startIdx-=t,this.startIdx<0&&(this.startIdx=0),this.updateGraph())},CandleChart.prototype.updateGraph=function(){this.isExistNextData()||!this.nextIqryDate?(this.getOffset(),this.setMaxMin(),this.draw()):this.delegator&&this.delegator.callNextData(this.nextIqryDate)},CandleChart.prototype.resetZoom=function(t){this.rateVal=1,this.pos.barW=this.DEF_BAR_W,this.barWidthChange(),t&&this.updateGraph()},CandleChart.prototype.zoomIn=function(){this.zoomInDiv.dispatchEvent(new Event(AEvent.ACTION_UP))},CandleChart.prototype.zoomOut=function(){this.zoomOutDiv.dispatchEvent(new Event(AEvent.ACTION_UP))},CandleChart.prototype.zoomInOut=function(){this.preScale!=this.rateVal&&(this.preScale=this.rateVal,this.pos.barW*=this.preScale,this.pos.barW<this.MIN_BAR_W?this.pos.barW=this.MIN_BAR_W:this.pos.barW>this.MAX_BAR_W&&(this.pos.barW=this.MAX_BAR_W)),this.barWidthChange(),this.updateGraph()},CandleChart.prototype.drawLongTabData=function(t){var s,t=t-this._getCompLeft(),t=this.pos.grpEX-t,i=parseInt(t/this.pos.barTot),t=(t%this.pos.barTot>this.pos.barTot&&(i+=1),this.startIdx+i);t<this.startIdx||t>this.endIdx||(t=this.data[t])&&(1==this.mode?this.infoDiv.innerHTML="<span>"+this.dateformat(t[0],this.dateParam)+"</span></br><span>종가 : "+afc.addComma(t[4])+"</span>":(s="<span>"+this.dateformat(t[0],this.dateParam)+"</span></br><span>시가 : "+afc.addComma(t[1])+'</span><span style="margin-left:20px;">고가 : '+afc.addComma(t[2])+"</span></br><span>저가 : "+afc.addComma(t[3])+'</span><span style="margin-left:20px;">종가 : '+afc.addComma(t[4])+"</span></br><span>거래량 : "+afc.addComma(t[5])+"</span>",null!=t[6]&&(s+="</br><span>거래대금 : "+afc.addComma(t[6])+"</span>"),this.infoDiv.innerHTML=s),this.longXdiv.style.left=this.startLineX-(i+1)*this.pos.barTot+"px",this.longYdiv.style.top=this.pos.upGrpSY+(this.upGrpMaxAm-t[4])*this.pos.upRateH+"px")},CandleChart.prototype.autoScroll=function(t){var s=this;150<t||(this.isExistNextData()?this.timer=setTimeout(function(){s.timer=null,s.mScrollLR?s.scrollLToR(1):s.scrollRToL(1),s.autoScroll(t+t/4)},t):(this.isReportedScrollLeft=!0,this.reportEvent("scrollleft")))},CandleChart.prototype.setTouchEvent=function(){var h,r,e,o,p,n,d=this,l=!1,c=!1,T=!1;AEvent.bindEvent(this.canvas,AEvent.ACTION_DOWN,function(t){T=c=!(l=!0),d.data&&0!=d.data.length&&(h=t.targetTouches[0],(r=t.targetTouches[1])&&(t.preventDefault(),t.stopPropagation()),e=h.pageX,o=h.pageY,d.timer&&(clearTimeout(d.timer),d.timer=null),d.scollSX=e,d.mStartTime=(new Date).getTime(),d.mOldTime=d.mStartTime,d.mStartX=e,d.mStartY=o,d.mEndX=d.mStartX,this.longTime=setTimeout(function(){r||(d.touchMode=1,d.infoDiv.style.display="",d.longXdiv.style.display="",d.longYdiv.style.display="",d.moveX=e,d.drawLongTabLines())},500))}),AEvent.bindEvent(this.canvas,AEvent.ACTION_MOVE,function(t){var s,i,a;clearTimeout(this.longTime),l&&d.data&&0!=d.data.length&&(h=t.targetTouches[0],r=t.targetTouches[1],e=h.pageX,o=h.pageY,r?(t.preventDefault(),t.stopPropagation(),p=r.pageX,n=r.pageY,h&&r&&(i={x:e,y:o},a={x:p,y:n},a=Math.sqrt(Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2)),d.lastDist||(d.lastDist=a),d.rateVal=(a/d.lastDist).toFixed(2),d.zoomState=0,d.zoomInOut(),d.lastDist=a)):1==d.touchMode?(d.moveX=e,d.drawLongTabLines()):(c||T||(10<Math.abs(d.mStartX-e)?c=!0:10<Math.abs(d.mStartY-o)&&(T=!0)),c&&t.stopPropagation(),T||(100<(i=(new Date).getTime())-d.mOldTime?(d.mStartTime=i,d.mOldTime=i,d.mStartX=e,d.mEndX=d.mStartX):(d.mOldTime=i,d.mEndX=e),(a=Math.abs(d.scollSX-e))>d.pos.barW&&(d.scollSX>e?(d.mScrollLR=!1,s=parseInt(a/d.pos.barW,10),d.scrollRToL(s)):(d.mScrollLR=!0,s=parseInt(a/d.pos.barW,10),d.scrollLToR(s)),d.scollSX=e))))}),AEvent.bindEvent(this.canvas,AEvent.ACTION_UP,function(t){l=!1,d.data&&0!=d.data.length&&(clearTimeout(this.longTime),d.touchMode=0,d.infoDiv&&(d.infoDiv.style.display="none",d.longXdiv.style.display="none",d.longYdiv.style.display="none"),c&&(t.preventDefault(),t.stopPropagation()),T||(t=(new Date).getTime()-d.mStartTime,d.speed=Math.abs(d.mEndX-d.mStartX)/t,.5<d.speed&&d.autoScroll((4-d.speed)/2),d.lastDist=null))})},CandleChart.prototype.setLongTabEvent=function(){var a,h,r,e,o,p,n=this,d=!1;AEvent.bindEvent(this.canvas,AEvent.ACTION_DOWN,function(t){d=!0,n.data&&0!=n.data.length&&(t.preventDefault(),t.stopPropagation(),a=t.targetTouches[0],h=t.targetTouches[1],r=a.pageX,n.timer&&(clearTimeout(n.timer),n.timer=null),n.scollSX=r,n.mStartTime=(new Date).getTime(),n.mOldTime=n.mStartTime,n.mStartX=r,n.mEndX=n.mStartX,this.longTime=setTimeout(function(){h||(n.touchMode=1,n.infoDiv.style.display="",n.longXdiv.style.display="",n.longYdiv.style.display="",n.moveX=r,n.drawLongTabLines())},500))}),AEvent.bindEvent(this.canvas,AEvent.ACTION_MOVE,function(t){var s,i;clearTimeout(this.longTime),d&&n.data&&0!=n.data.length&&(t.preventDefault(),t.stopPropagation(),a=t.targetTouches[0],h=t.targetTouches[1],r=a.pageX,e=a.pageY,h?(o=h.pageX,p=h.pageY,a&&h&&(t={x:r,y:e},i={x:o,y:p},i=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),n.lastDist||(n.lastDist=i),n.rateVal=(i/n.lastDist).toFixed(2),n.zoomState=0,n.zoomInOut(),n.lastDist=i)):1==n.touchMode?(n.moveX=r,n.drawLongTabLines()):(100<(t=(new Date).getTime())-n.mOldTime?(n.mStartTime=t,n.mOldTime=t,n.mStartX=r,n.mEndX=n.mStartX):(n.mOldTime=t,n.mEndX=r),(i=Math.abs(n.scollSX-r))>n.pos.barW&&(n.scollSX>r?(n.mScrollLR=!1,s=parseInt(i/n.pos.barW,10),n.scrollRToL(s)):(n.mScrollLR=!0,s=parseInt(i/n.pos.barW,10),n.scrollLToR(s)),n.scollSX=r)))}),AEvent.bindEvent(this.canvas,AEvent.ACTION_UP,function(t){d=!1,n.data&&0!=n.data.length&&(clearTimeout(this.longTime),n.touchMode=0,n.infoDiv&&(n.infoDiv.style.display="none",n.longXdiv.style.display="none",n.longYdiv.style.display="none"),t.preventDefault(),t.stopPropagation(),t=(new Date).getTime()-n.mStartTime,n.speed=Math.abs(n.mEndX-n.mStartX)/t,.5<n.speed&&n.autoScroll((4-n.speed)/2),n.lastDist=null)})},CandleChart.prototype.addNewData=function(t,s){if(t){if(this.startId--,!s){var i=t.length;s=[];for(var a=0;a<i;a++)s.push(a)}this.upDownArr.unshift([]),this.macdDataArr.unshift([]),this.dptDataArr.unshift([]),this.obvDataArr.unshift([]),this.rsiDataArr.unshift([]),this.rsiUp.unshift([]),this.rsiDw.unshift([]),this.topMaxMinArr.unshift([]),this.btmMaxMinArr.unshift([]),this.stkDataArr.unshift([]);for(var h=0;h<this.maKeyLen;h++)this.topMaArr[h].unshift([]),this.bottomMaArr[h].unshift([]);this.OPENVAL=t[s[1]],this.HIGHVAL=t[s[2]],this.LOWVAL=t[s[3]],this.CLOSEVAL=t[s[4]],this.QTYVAL=t[s[5]];var r=[t[s[0]],this.OPENVAL,this.HIGHVAL,this.LOWVAL,this.CLOSEVAL,this.QTYVAL];s[6]&&r.push(t[s[6]]),this.data.unshift(r),this.curOffset=0,this.makeUpDownData(),this.makeMoveAvgData(),this.makeDptData(),this.makeMacdObvData(),this.makeRSIData(),this.makeStochasticData(),this.updateGraph(),1==this.touchMode&&this.drawLongTabLines()}},CandleChart.prototype.addRealData=function(t,s){if(t){if(this.startIdx--,this.startIdx<0&&(this.startIdx=0),!s){var i=t.length;s=[];for(var a=0;a<i;a++)s.push(a)}this.upDownArr.unshift([]),this.macdDataArr.unshift([]),this.dptDataArr.unshift([]),this.obvDataArr.unshift([]),this.rsiDataArr.unshift([]),this.rsiUp.unshift([]),this.rsiDw.unshift([]),this.topMaxMinArr.unshift([]),this.btmMaxMinArr.unshift([]),this.stkDataArr.unshift([]);for(var h=0;h<this.maKeyLen;h++)this.topMaArr[h].unshift([]),this.bottomMaArr[h].unshift([]);var r=[t[s[0]],+t[s[1]],+t[s[2]],+t[s[3]],+t[s[4]],+t[s[5]]];s[6]&&r.push(+t[s[6]]),this.data.unshift(r),this.curOffset=0,this.preUpDown=this.upDownArr[this.curOffset+1]?this.upDownArr[this.curOffset+1][0]:2,this.OPENVAL=this.data[0][1],this.HIGHVAL=this.data[0][2],this.LOWVAL=this.data[0][3],this.CLOSEVAL=this.data[0][4],this.QTYVAL=this.data[0][5],this.makeUpDownData(),this.makeMoveAvgData(),this.makeDptData(),this.makeMacdObvData(),this.makeRSIData(),this.makeStochasticData(),this.updateGraph(),1==this.touchMode&&this.drawLongTabLines()}},CandleChart.prototype.updateRealData=function(t,s){if(t)if(s=s||Object.keys(t),0==this.data.length)this.setData([t],s);else{var i,a;t[s[4]]=+t[s[4]],t[s[0]]=this.data[0][0],t[s[1]]=this.data[0][1],t[s[2]]=Math.max(this.data[0][2],t[s[4]]),t[s[3]]=Math.min(this.data[0][3],t[s[4]]);for(var h=this.curOffset=0;h<this.maKeyLen;h++)i=this.maKeyArr[h],a=this.curOffset+i,this.data[a]&&(this.topMaTotalArr[h]+=this.data[a][CandleChart.INDEX_CLOSE],this.bottomMaTotalArr[h]+=this.data[a][5]),this.topMaTotalArr[h]-=this.data[0][CandleChart.INDEX_CLOSE],this.bottomMaTotalArr[h]-=this.data[0][5];a=this.curOffset+(i=10),this.dispTotal-=this.CLOSEVAL,this.data[a]&&(this.dispTotal+=this.data[a][4]),this.PRECLOSE?(0<(r=this.CLOSEVAL-this.PRECLOSE)?(this.PREOBV-=this.QTYVAL,this.UPVAL=r,this.DWVAL=0):r<0&&(this.PREOBV+=this.QTYVAL,this.UPVAL=0,this.DWVAL=-1*r),this.rsiUp[this.curOffset]=this.UPVAL,this.rsiDw[this.curOffset]=this.DWVAL):this.rsiUp[this.curOffset]=this.rsiDw[this.curOffset]=0,this.rsiTotalUp-=this.UPVAL,this.rsiTotalDw-=this.DWVAL,this.PRECLOSE=this.CLOSEVAL,this.obvDataArr[this.curOffset]=this.PREOBV,a=this.curOffset+(i=12),this.data[a]&&(this.rsiTotalUp+=this.rsiUp[a],this.rsiTotalDw+=this.rsiDw[a]);var r=[this.data[0][0],t[s[1]],t[s[2]],t[s[3]],t[s[4]],this.data[0][5]+ +t[s[5]]];s[6]&&r.push(+t[s[6]]),this.data[0]=r,this.EMA1=this.EMA2=this.data[0][CandleChart.INDEX_CLOSE],this.preUpDown=this.upDownArr[this.curOffset+1]?this.upDownArr[this.curOffset+1][0]:2,this.OPENVAL=this.data[0][1],this.HIGHVAL=this.data[0][2],this.LOWVAL=this.data[0][3],this.CLOSEVAL=this.data[0][4],this.QTYVAL=this.data[0][5],this.makeUpDownData(),this.makeMoveAvgData(),this.makeDptData(),this.makeMacdObvData(),this.makeRSIData(),this.makeStochasticData(),this.updateGraph(),1==this.touchMode&&this.drawLongTabLines()}},CandleChart.prototype.drawLongTabLines=function(){var t=this._getMiddleX();this.isShowLeft?t>this.moveX&&(this.infoDiv.style.left="",this.infoDiv.style.right="10px",this.isShowLeft=!1):t<this.moveX&&(this.infoDiv.style.right="",this.infoDiv.style.left="10px",this.isShowLeft=!0),this.drawLongTabData(this.moveX)},CandleChart.prototype.makeChartCanvasData=function(t,s){var i=t.length;if(!(i<1)){this.BAR_CNT>i&&this.reCalcWidth(i);var a=this.data.length;this.data.length+=i,this.curOffset=0,this.upDownArr.length+=i,this.macdDataArr.length+=i,this.dptDataArr.length+=i,this.obvDataArr.length+=i,this.rsiDataArr.length+=i,this.rsiUp.length+=i,this.rsiDw.length+=i,this.topMaxMinArr.length+=i,this.btmMaxMinArr.length+=i,this.stkDataArr.length+=i;for(var h=0;h<this.maKeyLen;h++)this.topMaTotalArr[h]=0,this.bottomMaTotalArr[h]=0,this.topMaArr[h].length+=i,this.bottomMaArr[h].length+=i;this.rsiTotalUp=0,this.rsiTotalDw=0,this.OPENVAL=0,this.HIGHVAL=0,this.LOWVAL=0,this.CLOSEVAL=0,this.QTYVAL=0,this.DISTVAL=0,this.TOPMAX=0,this.TOPMIN=999999999999,this.BTMMAX=0,this.BTMMIN=999999999999,this.TOPAVG=0,this.BTMAVG=0,this.EMA1,this.EMA2,this.MACD=0,this.SIGNAL=0,this.RSI=0,this.RSISIGNAL=0,this.DISTJONG=0,this.UPVAL=0,this.DWVAL=0,this.STCMAX=0,this.STCMIN=999999999999,this.STC_K=0,this.STC_FASTD=0,this.STC_SLOWD=0,this.PRECLOSE=null,this.PREOBV=0,this.preUpDown=2;var r,e,o,p,n,d=null,l="",c=[],T=s[0],C=s[1],A=s[2],u=s[3],m=s[4],S=s[5],M=s[6];this.EMA1=this.EMA2=+t[0][m];for(var f=i-1;-1<f;f--)c=[],(d=t[f])[C]=+d[C],d[A]=+d[A],d[u]=+d[u],d[m]=+d[m],7==(l=d[T].toString()).length&&(l="0"+l),c.push(l),this.OPENVAL=r=C?d[C]:d[m],this.HIGHVAL=e=A?d[A]:d[m],this.LOWVAL=o=u?d[u]:d[m],this.CLOSEVAL=p=d[m],this.QTYVAL=n=S?+d[S]:0,c.push(r),c.push(e),c.push(o),c.push(p),c.push(n),M&&c.push(+d[M]),this.curOffset=a+f,this.data[this.curOffset]=c,this.makeUpDownData(),this.makeMoveAvgData(),this.makeDptData(),this.makeMacdObvData(),this.makeRSIData(),this.makeStochasticData();for(f=this.curOffset-1;-1<f;f--)d=this.data[f],this.OPENVAL=d[1],this.HIGHVAL=d[2],this.LOWVAL=d[3],this.CLOSEVAL=d[4],this.QTYVAL=d[5],this.curOffset=f,this.makeMoveAvgData(),this.makeDptData(),this.makeMacdObvData(),this.makeRSIData(),this.makeStochasticData()}},CandleChart.prototype.makeUpDownData=function(){this.DISTVAL=this.CLOSEVAL-this.OPENVAL,0<this.DISTVAL?(this.preUpDown=1,this.upDownArr[this.curOffset]=[this.preUpDown,0,this.DISTVAL,0]):this.DISTVAL<0?(this.preUpDown=2,this.upDownArr[this.curOffset]=[this.preUpDown,0,0,-1*this.DISTVAL]):(this.data[this.curOffset+1]&&(this.CLOSEVAL>this.data[this.curOffset+1][CandleChart.INDEX_CLOSE]?this.preUpDown=1:this.CLOSEVAL<this.data[this.curOffset+1][CandleChart.INDEX_CLOSE]&&(this.preUpDown=2)),this.upDownArr[this.curOffset]=[this.preUpDown,2,0,0])},CandleChart.prototype.makeMoveAvgData=function(){var t,s;this.TOPMAX=this.HIGHVAL,this.TOPMIN=this.LOWVAL,this.BTMMAX=this.BTMMIN=this.QTYVAL;for(var i=0;i<this.maKeyLen;i++)t=this.maKeyArr[i],s=this.curOffset+t,this.topMaTotalArr[i]+=this.CLOSEVAL,this.bottomMaTotalArr[i]+=this.QTYVAL,this.data[s]?(this.topMaTotalArr[i]-=this.data[s][4],this.TOPAVG=this.topMaTotalArr[i]/t,this.topMaArr[i][this.curOffset]=[this.COLOR_SET[i],this.TOPAVG],this.TOPMAX=Math.max(this.TOPMAX,this.TOPAVG),this.TOPMIN=Math.min(this.TOPMIN,this.TOPAVG),this.bottomMaTotalArr[i]-=this.data[s][5],this.BTMAVG=this.bottomMaTotalArr[i]/t,this.bottomMaArr[i][this.curOffset]=[this.COLOR_SET[i],this.BTMAVG],this.BTMMAX=Math.max(this.BTMMAX,this.BTMAVG),this.BTMMIN=Math.min(this.BTMMIN,this.BTMAVG)):(this.topMaArr[i][this.curOffset]=["transparent",this.CLOSEVAL],this.bottomMaArr[i][this.curOffset]=["transparent",this.QTYVAL]);this.topMaxMinArr[this.curOffset]=[this.TOPMAX,this.TOPMIN],this.btmMaxMinArr[this.curOffset]=[this.BTMMAX,this.BTMMIN]},CandleChart.prototype.makeDptData=function(){var t=this.curOffset+10;this.dispTotal+=this.CLOSEVAL,this.data[t]?(this.dispTotal-=this.data[t][4],this.dptDataArr[this.curOffset]=[this.SUB_COLOR_SET[5][0],this.CLOSEVAL/(this.dispTotal/10)*100]):this.dptDataArr[this.curOffset]=["transparent",this.CLOSEVAL/(this.CLOSEVAL/10)*100]},CandleChart.prototype.makeMacdObvData=function(){var t;this.EMA1=2/13*(this.CLOSEVAL-this.EMA1)+this.EMA1,this.EMA2=2/27*(this.CLOSEVAL-this.EMA2)+this.EMA2,this.MACD=this.EMA1-this.EMA2,this.SIGNAL=.2*(this.MACD-this.SIGNAL)+this.SIGNAL,this.macdDataArr[this.curOffset]=[this.MACD,this.SIGNAL,this.MACD-this.SIGNAL],this.PRECLOSE?(0<(t=this.CLOSEVAL-this.PRECLOSE)?(this.PREOBV+=this.QTYVAL,this.UPVAL=t,this.DWVAL=0):t<0&&(this.PREOBV-=this.QTYVAL,this.UPVAL=0,this.DWVAL=-1*t),this.rsiUp[this.curOffset]=this.UPVAL,this.rsiDw[this.curOffset]=this.DWVAL):(this.rsiUp[this.curOffset]=0,this.rsiDw[this.curOffset]=0),this.rsiTotalUp+=this.UPVAL,this.rsiTotalDw+=this.DWVAL,this.PRECLOSE=this.CLOSEVAL,this.obvDataArr[this.curOffset]=this.PREOBV},CandleChart.prototype.makeRSIData=function(){var t=this.curOffset+12;this.data[t]&&(this.rsiTotalUp-=this.rsiUp[t],this.rsiTotalDw-=this.rsiDw[t]),0<this.rsiTotalUp&&0<this.rsiTotalDw?this.RSI=this.rsiTotalUp/(this.rsiTotalUp+this.rsiTotalDw)*100:this.RSI=0,this.RSISIGNAL||(this.RSISIGNAL=this.RSI),this.RSISIGNAL=.2*(this.RSI-this.RSISIGNAL)+this.RSISIGNAL,this.rsiDataArr[this.curOffset]=[this.RSI,this.RSISIGNAL]},CandleChart.prototype.makeStochasticData=function(){var t=this.curOffset+5-1;this.data[t]?(this.STCMAX=Math.max(this.data[t-4][2],this.data[t-3][2],this.data[t-2][2],this.data[t-1][2],this.data[t][2]),this.STCMIN=Math.min(this.data[t-4][3],this.data[t-3][3],this.data[t-2][3],this.data[t-1][3],this.data[t][3])):(this.STCMAX=Math.max(this.STCMAX,this.HIGHVAL),this.STCMIN=Math.min(this.STCMIN,this.LOWVAL)),this.STC_K=(this.CLOSEVAL-this.STCMIN)/(this.STCMAX-this.STCMIN)*100,this.STC_FASTD||(this.STC_FASTD=this.STC_K),this.STC_FASTD=.5*(this.STC_K-this.STC_FASTD)+this.STC_FASTD,this.STC_SLOWD||(this.STC_SLOWD=this.STC_FASTD),this.STC_SLOWD=.5*(this.STC_FASTD-this.STC_SLOWD)+this.STC_SLOWD,this.stkDataArr[this.curOffset]=[this.STC_K,this.STC_FASTD,this.STC_SLOWD]},CandleChart.prototype.setLongtabLineColor=function(t){this.longXdiv.style.background=t,this.longYdiv.style.background=t},CandleChart.prototype.getLongtabLineColor=function(t){return this.longXdiv.style.background},CandleChart.prototype.getMappingCount=function(){return["Date","Start Price","High Price","Low Price","End Price","Trade Qty","Trade Price"]},CandleChart.prototype.getQueryData=function(t,s,i){},CandleChart.prototype.setQueryData=function(s,i,a){if(i)if(0==s.length)AToast.show("데이터가 존재하지 않습니다.");else if(a.isReal){let t;var h,r;this.intervals==CandleChart.INTERVALS_TICK?(t=this.tickCount||this.updateRefVal,++this.currentTickCount,1==this.currentTickCount?(s[0][i[1]]=s[0][i[4]],s[0][i[2]]=s[0][i[4]],s[0][i[3]]=s[0][i[4]],this.addRealData(s[0],i)):this.updateRealData(s[0],i),this.currentTickCount>=t&&(this.currentTickCount=0)):this.intervals!=CandleChart.INTERVALS_MINUTE||(t=this.updateTime||this.updateRefVal,a=this.data[0]?String(this.data[0][0]):"000000",(r=3600*(r=String(s[0][i[0]])).substring(0,2)+60*r.substring(2,4)+ +r.substring(4,6))<=(a=3600*a.substring(0,2)+60*a.substring(2,4)+ +a.substring(4,6)))?this.updateRealData(s[0],i):(a+=((r=parseInt((r-a)/t))+1)*t,r=parseInt(a/3600),a%=3600,h=parseInt(a/60),a=a%=60,s[0][i[0]]=[r<10?"0"+r:r,h<10?"0"+h:h,a<10?"0"+a:a].join(""),s[0][i[1]]=s[0][i[2]]=s[0][i[3]]=s[0][i[4]],this.addRealData(s[0],i))}else this.makeChartCanvasData(s,i),this.updateGraph()}}();