!async function(){await afc.import("Framework/stock/component/BaseChart.js"),(CompareChart=class extends BaseChart{constructor(){super(),this.frwName="stock",this.isCandleChart=!1,this.lineData=[],this.lineDataText=[],this.lineDataColor=StockColor.COMPARE_COLORS,this.lineRate=[],this.delegator=null,this.preScale=1,this.rateVal=1,this.zoomState=0,this.lastDist=0,this.scollSX=0,this.scollEX=0,this.speed=10,this.mStartTime=0,this.mOldTime=0,this.mStartX=0,this.mEndX=0,this.mScrollLR=!1,this.timer=null,this.offset=0,this.startIdx=0,this.startLineX=0,this.endIdx=0,this.BAR_CNT=50,this.subType=0,this.prdCls=0,this.dateformatFunc=[afc.formatDate,afc.formatDate,afc.formatMonth,null,null,afc.formatDateTime,null,afc.formatTic],this.dateformat=this.dateformatFunc[this.prdCls],this.dashType=[1.5,4],this.TEXT_SIZE="16px",this.defColorObj={BACK:StockColor.BACK,TEXT:StockColor.TEXT,DOT:StockColor.DOT,DIVLINE:StockColor.DIVLINE,UP:StockColor.UP_COLOR,DOWN:StockColor.DOWN_COLOR},this.colorObj={BACK:StockColor.BACK,TEXT:StockColor.TEXT,DOT:StockColor.DOT,DIVLINE:StockColor.DIVLINE,UP:StockColor.UP_COLOR,DOWN:StockColor.DOWN_COLOR},this.COLOR_ARR=[this.colorObj.DOWN,this.colorObj.UP,this.colorObj.DOWN],this.touchEvent=null,this.isFirst=!0,this.ROW_CNT=18,this.AM_R_WIDTH=100,this.AM_L_WIDTH=0,this.MAX_BAR_W=80,this.DEF_BAR_W=8,this.BAR_TERM=1,this.SIGAIDX=1,this.GOGAIDX=2,this.JEOGAIDX=3,this.JONGGAIDX=4,this.DEALQTIDX=5,this.upGrpMaxAm=0,this.upGrpMinAm=0,this.pos={cavasW:0,cavasH:0,grpW:0,grpEX:0,dtXs:[],amYs:[],amPad:0,txtY:0,upGrpSY:0,upDtY:0,upGrpEY:0,upGrpH:0,dwDtY:0,upRateH:0,barW:this.DEF_BAR_W,barTot:0},this.drawBackType=null,this.drawTextType=null,this.drawChartType=null,this.compLeft=0,this.middleX=0}}).CONTEXT={tag:'<div data-base="CompareChart" data-class="CompareChart" class="CompareChart-Style" >            <canvas width="640px" height="400px"></canvas>\t        <div class="chart-vline" style="display: none;"></div>\t\t\t<div class="chart-hline" style="display: none;"></div>\t\t\t<div class="chart-zoomLay"><div class="chart-zoomIn" >+</div><div class="chart-zoomOut">-</div></div>\t\t\t<div class="chart-info" style="display: none;"></div>\t\t</div>',defStyle:{width:"640px",height:"400px"},events:[]},CompareChart.prototype.init=function(t,s){var i,a;BaseChart.prototype.init.call(this,t,s),this.isFirst=!0,this.longXdiv=this.element.children[1],this.longYdiv=this.element.children[2],this.zoomDiv=this.element.children[3],this.zoomInDiv=this.zoomDiv.children[0],this.zoomOutDiv=this.zoomDiv.children[1],this.infoDiv=this.element.children[4],this.initEvent(),this.isDev()&&(i=this,a="CandleChart",window.CandleChart.demoData?(this.setData(window[a].demoData),this.addCompareData(window[this.className].demoData)):$.ajax({url:"Framework/stock/asset/"+a+"Data.js",async:!1,success:function(t){window[a].demoData=JSON.parse(t),i.setData(window[a].demoData),i.addCompareData(window[i.className].demoData)},error:function(t){console.log(t)}}))},CompareChart.prototype.extractColorObj=function(){BaseChart.prototype.extractColorObj.call(this),this.COLOR_ARR=[this.colorObj.DOWN,this.colorObj.UP,this.colorObj.DOWN]},CompareChart.prototype.initEvent=function(){this.setTouchEvent(),this.setZoomEvent()},CompareChart.prototype.updatePosition=function(t,s){BaseChart.prototype.updatePosition.call(this,t,s),this.calcPosition(this.eleW,this.eleH),this.data&&this.updateGraph()},CompareChart.prototype.setZoomEvent=function(){var s=this;$(this.zoomInDiv).on(AEvent.ACTION_UP,function(t){s.data&&0!=s.data.length&&(1!=s.zoomState&&(s.rateVal=1,s.zoomState=1),s.rateVal=parseFloat(s.rateVal)+.01,s.zoomInOut())}),$(this.zoomOutDiv).on(AEvent.ACTION_UP,function(t){s.data&&0!=s.data.length&&(2!=s.zoomState&&(s.rateVal=1,s.zoomState=2),s.rateVal=parseFloat(s.rateVal)-.01,s.zoomInOut())})},CompareChart.prototype.setDelegator=function(t){this.delegator=t},CompareChart.prototype.calcPosition=function(t,s){this.pos.cavasW=t,this.pos.cavasH=s,this.pos.grpEX=t-this.AM_R_WIDTH,this.pos.grpW=this.pos.grpEX-this.AM_L_WIDTH,this.pos.amPad=t-5,this.pos.dtXs=[this.AM_L_WIDTH+.25*this.pos.grpW,this.AM_L_WIDTH+.5*this.pos.grpW,this.AM_L_WIDTH+.75*this.pos.grpW],this.pos.upGrpSY=s/this.ROW_CNT,this.pos.txtY=this.pos.upGrpSY/2,this.pos.upGrpEY=17*this.pos.upGrpSY,this.pos.upGrpH=this.pos.upGrpEY-this.pos.upGrpSY,this.pos.upDtY=this.pos.upGrpEY+this.pos.txtY,this.pos.amYs=[this.pos.upGrpSY,5*this.pos.upGrpSY,9*this.pos.upGrpSY,13*this.pos.upGrpSY,this.pos.upGrpEY],this.pos.dwDtY=this.pos.upGrpEY+this.pos.txtY,this.TEXT_SIZE=t<s?.03*this.pos.cavasW+"px":.03*this.pos.cavasH+"px",this.pos.barTot=this.pos.grpW/this.BAR_CNT,this.pos.barW=this.pos.barTot-this.BAR_TERM,this.startLineX=this.pos.grpEX+this.pos.barW/2},CompareChart.prototype.addCompareData=function(t){15<this.lineData.length?AToast.show("더이상 추가할 수 없습니다."):(this.lineDataText.push(t[0]),this.lineData.push(t[1]),this.updateGraph())},CompareChart.prototype.setData=function(t,s){if(this.resetData(),!s){var i=t[0].length;s=new Array;for(var a=0;a<i;a++)s.push(a)}this.lineData.push([]),this.lineDataText.push("기본종목"),this.makeChartCanvasData(t,s),this.updateGraph()},CompareChart.prototype.setIsFirst=function(t){this.isFirst=t},CompareChart.prototype.getIsFirst=function(){return this.isFirst},CompareChart.prototype.setPrdCls=function(t){this.prdCls=t,this.dateformat=this.dateformatFunc[this.prdCls]},CompareChart.prototype.resetData=function(){this.lineData=new Array,this.lineDataText=new Array,this.preScale=1,this.rateVal=1,this.zoomState=0,this.lastDist=0,this.scollSX=0,this.scollEX=0,this.speed=0,this.mStartTime=0,this.mOldTime=0,this.mStartX=0,this.mEndX=0,this.mScrollLR=!1,this.timer=null,this.offset=0,this.startIdx=0,this.endIdx=0,this.pos.barTot=this.pos.grpW/this.BAR_CNT,this.pos.barW=this.pos.barTot-this.BAR_TERM,this.isFirst=!0,this.upGrpMaxAm=0,this.upGrpMinAm=0,this.nextIqryDate="",this.data=new Array,this.upDownArr=new Array,this.ctx.clearRect(0,0,this.pos.cavasW,this.pos.cavasH),this.drawBackLine()},CompareChart.prototype.draw=function(){this.ctx.clearRect(0,0,this.pos.cavasW,this.pos.cavasH),this.ctx.font=this.TEXT_SIZE+" '"+this.FONT_FAMILY+"'",this.ctx.textBaseline="middle",this.drawBackLine(),this.drawBackText(),this.drawGraph()},CompareChart.prototype.drawBackLine=function(){this.ctx.beginPath(),this.ctx.lineWidth=1.5,this.ctx.strokeStyle=this.colorObj.DOT;for(var t=0;t<5;t++)this.drawDashedLine(this.AM_L_WIDTH+0,this.pos.amYs[t],this.pos.grpEX,this.pos.amYs[t],this.dashType);for(t=0;t<3;t++)this.drawDashedLine(this.pos.dtXs[t]-1,0,this.pos.dtXs[t],this.pos.upGrpEY,this.dashType);this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.lineWidth=1,this.ctx.strokeStyle=this.colorObj.DIVLINE,this.ctx.moveTo(this.pos.grpEX,0),this.ctx.lineTo(this.pos.grpEX,this.pos.cavasH),this.ctx.stroke(),this.ctx.closePath()},CompareChart.prototype.drawBackText=function(){var t="",s=this.AM_L_WIDTH,i=(this.ctx.textAlign="left",0);for(this.isCandleChart&&(i=1);i<this.lineDataText.length;i++)s+=this.ctx.measureText(t).width+10,t=this.lineDataText[i],this.ctx.fillStyle=this.lineDataColor[i],this.ctx.fillText(t,s,this.pos.txtY)},CompareChart.prototype.setMaxMin=function(){this.upGrpMaxAm=0,this.upGrpMinAm=Number.MAX_VALUE;for(var t=this.startIdx;t<this.endIdx;t++)this.upGrpMaxAm=Math.max(this.upGrpMaxAm,this.data[t][4]),this.upGrpMinAm=Math.min(this.upGrpMinAm,this.data[t][4]);this.pos.upRateH=(this.pos.upGrpEY-this.pos.upGrpSY)/(this.upGrpMaxAm-this.upGrpMinAm);var s,i=0,a=Number.MAX_VALUE;this.lineRate=new Array,this.lineRate.push([this.upGrpMaxAm,this.pos.upRateH]);for(t=1;t<this.lineData.length;t++){for(var h=this.lineData[t],e=this.startIdx;e<this.endIdx;e++)i=Math.max(i,h[e]),a=Math.min(a,h[e]);s=(this.pos.upGrpEY-this.pos.upGrpSY)/(i-a),this.lineRate.push([i,s])}},CompareChart.prototype.drawGraph=function(){if(this.data&&0!=this.data.length){var t,s,i,a=this.data,h=this.startLineX,e=(this.ctx.fillStyle=this.colorObj.TEXT,this.ctx.textAlign="center",a[parseInt(.75*this.BAR_CNT)+this.startIdx]),o=a[parseInt(.5*this.BAR_CNT)+this.startIdx],r=a[parseInt(.25*this.BAR_CNT)+this.startIdx];if(e&&this.ctx.fillText(this.dateformat(e[0]),this.pos.dtXs[0],this.pos.dwDtY),o&&this.ctx.fillText(this.dateformat(o[0]),this.pos.dtXs[1],this.pos.dwDtY),r&&this.ctx.fillText(this.dateformat(r[0]),this.pos.dtXs[2],this.pos.dwDtY),this.ctx.textAlign="right",this.ctx.fillText(this._getDecimalValue(parseInt(this.upGrpMaxAm)),this.pos.amPad,this.pos.amYs[0]),this.ctx.fillText(this._getDecimalValue(parseInt(this.upGrpMaxAm-.25*(this.upGrpMaxAm-this.upGrpMinAm))),this.pos.amPad,this.pos.amYs[1]),this.ctx.fillText(this._getDecimalValue(parseInt(this.upGrpMaxAm-.5*(this.upGrpMaxAm-this.upGrpMinAm))),this.pos.amPad,this.pos.amYs[2]),this.ctx.fillText(this._getDecimalValue(parseInt(this.upGrpMaxAm-.75*(this.upGrpMaxAm-this.upGrpMinAm))),this.pos.amPad,this.pos.amYs[3]),this.ctx.fillText(this._getDecimalValue(parseInt(this.upGrpMinAm)),this.pos.amPad,this.pos.amYs[4]),this.isCandleChart)for(var p=this.startIdx;p<this.endIdx;p++)t=a[p],h-=this.pos.barTot,s=this.pos.upGrpSY+Math.abs(this.upGrpMaxAm-a[p][this.GOGAIDX])*this.pos.upRateH,this.ctx.beginPath(),this.ctx.lineWidth=this.pos.barW,this.ctx.strokeStyle=this.COLOR_ARR[this.upDownArr[p][0]],this.ctx.moveTo(h,this.pos.upGrpSY+(this.upGrpMaxAm-t[this.SIGAIDX])*this.pos.upRateH),i=this.pos.upGrpSY+(this.upGrpMaxAm-t[this.JONGGAIDX])*this.pos.upRateH,this.ctx.lineTo(h,i+this.upDownArr[p][1]),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.lineWidth="1.5",this.ctx.moveTo(h,s),this.ctx.lineTo(h,s+Math.abs(t[this.GOGAIDX]-t[this.JEOGAIDX])*this.pos.upRateH),this.ctx.stroke(),this.ctx.closePath();this.drawCompareLine()}},CompareChart.prototype.drawCompareLine=function(){var t,s,i=null,a=0;for(this.isCandleChart&&(a=1);a<this.lineData.length;a++){s=this.lineDataColor[a],i=this.startLineX-this.pos.barTot,this.ctx.beginPath(),this.ctx.strokeStyle=s,t=this.lineData[a],this.ctx.moveTo(i,this.pos.upGrpSY+(this.lineRate[a][0]-t[this.startIdx])*this.lineRate[a][1]);for(var h=this.startIdx+1;h<this.endIdx;h++)i-=this.pos.barTot,this.ctx.lineTo(i,this.pos.upGrpSY+(this.lineRate[a][0]-t[h])*this.lineRate[a][1]);this.ctx.stroke(),this.ctx.closePath()}},CompareChart.prototype.isExistNextData=function(){return!(this.startIdx+this.BAR_CNT>this.data.length)},CompareChart.prototype.getOffset=function(){var t=this.startIdx+this.BAR_CNT;t>this.data.length?this.endIdx=this.data.length:this.endIdx=t},CompareChart.prototype.barWidthChange=function(){this.pos.barTot=this.pos.barW+this.BAR_TERM,this.BAR_CNT=parseInt(this.pos.grpW/this.pos.barTot,10),this.startLineX=this.pos.grpEX+this.pos.barW/2},CompareChart.prototype.scrollLToR=function(t){this.isExistNextData()?(this.startIdx+=t,this.updateGraph()):this.getOffset()},CompareChart.prototype.scrollRToL=function(t){this.data.length<1?this.getOffset():(this.startIdx-=t,this.startIdx<0&&(this.startIdx=0),this.updateGraph())},CompareChart.prototype.updateGraph=function(){this.isExistNextData()||!this.nextIqryDate?(this.getOffset(),this.setMaxMin(),this.draw()):this.delegator&&this.delegator.callNextData(this.nextIqryDate)},CompareChart.prototype.zoomInOut=function(){this.preScale!=this.rateVal&&(this.preScale=this.rateVal,this.pos.barW*=this.preScale,this.pos.barW<this.DEF_BAR_W?this.pos.barW=this.DEF_BAR_W:this.pos.barW>this.MAX_BAR_W?this.pos.barW=this.MAX_BAR_W:(this.barWidthChange(),this.updateGraph()))},CompareChart.prototype.drawLongTabData=function(t){var t=t-this.compLeft,t=this.pos.grpEX-t,s=parseInt(t/this.pos.barTot),i=(t%this.pos.barTot>this.pos.barTot&&(s+=1),this.startIdx+s);if(!(i<this.startIdx||i>this.endIdx)){var a,t=this.data[i],h="";if(t){h+="<span>"+this.dateformat(t[0])+"</span></br>";for(var e=0;e<this.lineDataText.length;e++)a=this.lineData[e][i],h+='<span style="color:'+this.lineDataColor[e]+';">'+this.lineDataText[e]+" : "+this._getDecimalValue(a)+"</span></br>";this.infoDiv.innerHTML=h,this.longXdiv.style.left=this.startLineX-(s+1)*this.pos.barTot+"px",this.longYdiv.style.top=this.pos.upGrpSY+(this.upGrpMaxAm-t[4])*this.pos.upRateH+"px"}}},CompareChart.prototype.autoScroll=function(t){var s=this;150<t||!this.isExistNextData()||(this.timer=setTimeout(function(){s.timer=null,s.mScrollLR?s.scrollLToR(1):s.scrollRToL(1),s.autoScroll(t+t/4)},t))},CompareChart.prototype.setTouchEvent=function(){var a,h,e,o,r,p,n=this;this.canvas.addEventListener(AEvent.ACTION_DOWN,function(t){this.isDown=!0,n.data&&0!=n.data.length&&(t.preventDefault(),t.stopPropagation(),afc.isPC&&(t.touches=[{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}]),a=t.touches[0],h=t.touches[1],e=a.pageX,n.timer&&(clearTimeout(n.timer),n.timer=null),n.scollSX=e,n.mStartTime=(new Date).getTime(),n.mOldTime=n.mStartTime,n.mStartX=e,n.mEndX=n.mStartX,h||(this.longTime=setTimeout(function(){n.mode=1,n.infoDiv.style.display="",n.longXdiv.style.display="",n.longYdiv.style.display="",n.moveX=e,n.drawLongTabLines()},500)))}),this.canvas.addEventListener(AEvent.ACTION_MOVE,function(t){if(clearTimeout(this.longTime),n.data&&0!=n.data.length){if(t.preventDefault(),t.stopPropagation(),afc.isPC){if(!this.isDown)return;t.touches=[{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}]}var s,i;a=t.touches[0],h=t.touches[1],e=a.pageX,o=a.pageY,h?(r=h.pageX,p=h.pageY,a&&h&&(t={x:e,y:o},i={x:r,y:p},i=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),n.lastDist||(n.lastDist=i),n.rateVal=(i/n.lastDist).toFixed(2),n.zoomState=0,n.zoomInOut(),n.lastDist=i)):1==n.mode?(n.moveX=e,n.drawLongTabLines()):(100<(t=(new Date).getTime())-n.mOldTime?(n.mStartTime=t,n.mOldTime=t,n.mStartX=e,n.mEndX=n.mStartX):(n.mOldTime=t,n.mEndX=e),(i=Math.abs(n.scollSX-e))>n.pos.barW&&(n.scollSX>e?(n.mScrollLR=!1,s=parseInt(i/n.pos.barW,10),n.scrollRToL(s)):(n.mScrollLR=!0,s=parseInt(i/n.pos.barW,10),n.scrollLToR(s)),n.scollSX=e))}}),this.canvas.addEventListener(AEvent.ACTION_UP,function(t){this.isDown=!1,n.data&&0!=n.data.length&&(clearTimeout(this.longTime),afc.isPC&&(t.touches=[{clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY}]),n.mode=0,n.infoDiv&&(n.infoDiv.style.display="none",n.longXdiv.style.display="none",n.longYdiv.style.display="none"),t.preventDefault(),t.stopPropagation(),t=(new Date).getTime()-n.mStartTime,n.speed=Math.abs(n.mEndX-n.mStartX)/t,.5<n.speed&&n.autoScroll((4-n.speed)/2),n.lastDist=null)})},CompareChart.prototype.addNewData=function(t,s){if(t){if(this.startId--,!s){var i=t.length;s=new Array;for(var a=0;a<i;a++)s.push(a)}this.upDownArr.unshift([]),this.SIGAVAL=t[s[1]],this.GOGAVAL=t[s[2]],this.JEGAVAL=t[s[3]],this.JONGGAVAL=t[s[4]],this.QTYVAL=t[s[5]],this.data.unshift([t[s[0]],this.SIGAVAL,this.GOGAVAL,this.JEGAVAL,this.JONGGAVAL,this.QTYVAL,t[s[6]]]),this.curOffset=0,this.makeUpDownData(),1==this.mode&&this.drawLongTabLines()}},CompareChart.prototype.drawLongTabLines=function(){this.isShowLeft?this.middleX>this.moveX&&(this.infoDiv.style.left="",this.infoDiv.style.right="10px",this.isShowLeft=!1):this.middleX<this.moveX&&(this.infoDiv.style.right="",this.infoDiv.style.left="10px",this.isShowLeft=!0),this.drawLongTabData(this.moveX)},CompareChart.prototype.makeChartCanvasData=function(t,s){var i=t.length;if(!(i<1)){var a,h,e,o,r,p,n=this.data.length,l=(this.data.length+=i,this.lineData[0]||(this.lineData[0]=new Array),this.lineData[0].length+=i,this.termCnt=0,this.curOffset=0,this.preTermIdx=0,this.upDownArr.length+=i,this.SIGAVAL=0,this.GOGAVAL=0,this.JEGAVAL=0,this.JONGGAVAL=0,this.QTYVAL=0,this.DISTVAL=0,this.preUpDown=2,new Array),c=s[0],d=s[1],m=s[2],u=s[3],D=s[4],C=s[5],A=s[6];this.EMA1=this.EMA2=t[0][D];for(var x=i-1;-1<x;x--)a=t[x],(l=new Array).push(a[c]),this.SIGAVAL=h=d?a[d]:a[D],this.GOGAVAL=e=m?a[m]:a[D],this.JEGAVAL=o=u?a[u]:a[D],this.JONGGAVAL=r=a[D],this.QTYVAL=p=C?a[C]:0,l.push(h),l.push(e),l.push(o),l.push(r),l.push(p),l.push(A?a[A]:0),this.curOffset=n+x,this.data[this.curOffset]=l,this.lineData[0][this.curOffset]=r,this.makeUpDownData()}},CompareChart.prototype.makeUpDownData=function(){this.DISTVAL=this.JONGGAVAL-this.SIGAVAL,0<this.DISTVAL?(this.preUpDown=1,this.upDownArr[this.curOffset]=[this.preUpDown,0,this.DISTVAL,0]):this.DISTVAL<0?(this.preUpDown=2,this.upDownArr[this.curOffset]=[this.preUpDown,0,0,-1*this.DISTVAL]):this.upDownArr[this.curOffset]=[this.preUpDown,2,0,0]},CompareChart.prototype.getMappingCount=function(){return["Date","Start Price","High Price","Low Price","End Price","Trade Qty","Trade Price"]},CompareChart.prototype.getQueryData=function(t,s){},CompareChart.prototype.setQueryData=function(t,s){s&&(0==t.length?AToast.show("데이터가 존재하지 않습니다."):(this.makeChartCanvasData(t,s),this.updateGraph()))}}();