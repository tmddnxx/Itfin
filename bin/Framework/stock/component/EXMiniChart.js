!async function(){await afc.import("Framework/stock/component/BaseChart.js"),(EXMiniChart=class extends BaseChart{constructor(){super(),this.frwName="stock",this.basePrice=0,this.maxCount=52,this.colorMode="black",this.dateKey=0,this.valueKey=1,this.priceArr=null,this.timeArr=null,this.timeEnd=0,this.mode="price",this.termW=0,this.isRealMode=!1,this.maxAm=0,this.minAm=Number.MAX_VALUE,this.defColorObj={BACK:StockColor.BACK_D,DIVLINE:StockColor.DIVLINE_D,BASELINE:StockColor.BASELINE_D,TEXT:StockColor.TEXT_D,TEXT_BASE:StockColor.TEXT_BASE_D,TIMELINE:StockColor.TIMELINE_D,UP:StockColor.UP_COLOR_D,DOWN:StockColor.DOWN_COLOR_D,TEXT_TIME:StockColor.TEXT_TIME_D,TEXT_LEFT:StockColor.TEXT_LEFT_D,CONT_BACK:StockColor.CONT_BACK_D,CONT_ROUND:StockColor.CONT_ROUND_D},this.colorObj={BACK:StockColor.BACK_D,DIVLINE:StockColor.DIVLINE_D,BASELINE:StockColor.BASELINE_D,TEXT:StockColor.TEXT_D,TEXT_BASE:StockColor.TEXT_BASE_D,TIMELINE:StockColor.TIMELINE_D,UP:StockColor.UP_COLOR_D,DOWN:StockColor.DOWN_COLOR_D,TEXT_TIME:StockColor.TEXT_TIME_D,TEXT_LEFT:StockColor.TEXT_LEFT_D,CONT_BACK:StockColor.CONT_BACK_D,CONT_ROUND:StockColor.CONT_ROUND_D},this.pos={txtX:0,grpSY:0,hourSY:0,hourY:0,grpEY:0,grpH:0,baseY:0,grpR:0,grpLeft:80,grpTp:null},this.updateTime=300}}).CONTEXT={tag:'<div data-base="EXMiniChart" data-class="EXMiniChart" class="EXMiniChart-Style" ><canvas width="300px" height="200px"></canvas></div>',defStyle:{width:"300px",height:"200px"},events:[]},EXMiniChart.prototype.init=function(t,i){BaseChart.prototype.init.call(this,t,i),theApp.themeMode&&"MO"==theApp.themeMode&&this.setColorMode("white")},EXMiniChart.prototype.setMaxCount=function(t){this.maxCount=t},EXMiniChart.prototype.setColorMode=function(t){this.colorMode=t,"white"==this.colorMode?(this.defColorObj={BACK:StockColor.BACK,DIVLINE:StockColor.DIVLINE,BASELINE:StockColor.BASELINE,TEXT:StockColor.TEXT,TEXT_BASE:StockColor.TEXT_BASE,TIMELINE:StockColor.TIMELINE,UP:StockColor.UP_COLOR,DOWN:StockColor.DOWN_COLOR,TEXT_TIME:StockColor.TEXT_TIME,TEXT_LEFT:StockColor.TEXT_LEFT,CONT_BACK:StockColor.CONT_BACK,CONT_ROUND:StockColor.CONT_ROUND},this.colorObj={BACK:StockColor.BACK,DIVLINE:StockColor.DIVLINE,BASELINE:StockColor.BASELINE,TEXT:StockColor.TEXT,TEXT_BASE:StockColor.TEXT_BASE,TIMELINE:StockColor.TIMELINE,UP:StockColor.UP_COLOR,DOWN:StockColor.DOWN_COLOR,TEXT_TIME:StockColor.TEXT_TIME,TEXT_LEFT:StockColor.TEXT_LEFT,CONT_BACK:StockColor.CONT_BACK,CONT_ROUND:StockColor.CONT_ROUND}):(this.defColorObj={BACK:StockColor.BACK_D,DIVLINE:StockColor.DIVLINE_D,BASELINE:StockColor.BASELINE_D,TEXT:StockColor.TEXT_D,TEXT_BASE:StockColor.TEXT_BASE_D,TIMELINE:StockColor.TIMELINE_D,UP:StockColor.UP_COLOR_D,DOWN:StockColor.DOWN_COLOR_D,TEXT_TIME:StockColor.TEXT_TIME_D,TEXT_LEFT:StockColor.TEXT_LEFT_D,CONT_BACK:StockColor.CONT_BACK_D,CONT_ROUND:StockColor.CONT_ROUND_D},this.colorObj={BACK:StockColor.BACK_D,DIVLINE:StockColor.DIVLINE_D,BASELINE:StockColor.BASELINE_D,TEXT:StockColor.TEXT_D,TEXT_BASE:StockColor.TEXT_BASE_D,TIMELINE:StockColor.TIMELINE_D,UP:StockColor.UP_COLOR_D,DOWN:StockColor.DOWN_COLOR_D,TEXT_TIME:StockColor.TEXT_TIME_D,TEXT_LEFT:StockColor.TEXT_LEFT_D,CONT_BACK:StockColor.CONT_BACK_D,CONT_ROUND:StockColor.CONT_ROUND_D})},EXMiniChart.prototype.setColors=function(t,i){if(t)for(var s in t)t.hasOwnProperty(s)&&(this.colorOpt[s]=t[s]);i&&this.draw()},EXMiniChart.prototype.updatePosition=function(t,i){BaseChart.prototype.updatePosition.call(this,t,i),this.termW=(this.eleW-this.pos.grpLeft)/this.maxCount,this.calcPosition(this.eleW,this.eleH),this.updateGraph()},EXMiniChart.prototype.setData=function(t,i){null!=i&&(this.basePrice=i),this.data=t,this.maxAm=0,this.minAm=Number.MAX_VALUE,this.priceArr=null,this.timeArr=null,this.data.length>=this.maxCount?this.data.length=this.maxCount:this.maxCount=this.data.length,this.updateGraph()},EXMiniChart.prototype.setKeys=function(t,i){this.dateKey=t,this.valueKey=i},EXMiniChart.prototype.addNewData=function(t){this.data&&(this.data.length>=this.maxCount&&(this.data.length=this.maxCount),this.data[0][0]==t[0]||t[0]%5!=0?this.data[0]=t:(this.data.pop(),this.data.unshift(t)),this.maxAm=0,this.minAm=Number.MAX_VALUE,this.updateGraph())},EXMiniChart.prototype.checkDrawPossible=function(){return!!(this.data&&0<this.eleW&&0<this.eleH)},EXMiniChart.prototype.calcPosition=function(t,i){"line"!=this.mode?(this.pos.grpLeft=80,this.pos.txtX=this.pos.grpLeft/2):this.pos.grpLeft=0,this.pos.grpSY=.1*this.eleH,this.pos.hourSY=this.eleH-30,this.pos.hourY=this.eleH-(this.eleH-this.pos.hourSY)/3,this.pos.grpEY=this.pos.hourSY-this.pos.grpSY,this.pos.grpH=this.pos.grpEY-this.pos.grpSY},EXMiniChart.prototype.setMaxMin=function(){this.priceArr=new Array,this.timeArr=new Array;for(var t,i=0,s=0;s<this.data.length;s++)t=this.data[s][this.valueKey],(i=this.data[s][this.dateKey])%100==5&&this.timeArr.push([s,i.substring(0,2)+":00"]),t>this.maxAm&&(this.maxAm=t),t<this.minAm&&(this.minAm=t);this.minAm>=this.basePrice?(this.pos.baseY=this.pos.grpEY,this.pos.grpR=this.pos.grpH/(this.maxAm-this.basePrice),this.pos.grpTp="up"):this.maxAm<=this.basePrice?(this.pos.grpR=this.pos.grpH/(this.basePrice-this.minAm),this.pos.baseY=this.pos.grpSY,this.pos.grpTp="down"):(this.pos.grpR=this.pos.grpH/(this.maxAm-this.minAm),this.pos.baseY=this.pos.grpSY+(this.maxAm-this.basePrice)*this.pos.grpR,this.pos.grpTp="both"),this.priceArr=[[this.maxAm,this.pos.grpSY],[this.minAm,this.pos.grpEY],[this.basePrice,this.pos.baseY]]},EXMiniChart.prototype.updateGraph=function(){this.basePrice&&this.data?(this.setMaxMin(),this.draw()):(this.ctx.clearRect(0,0,this.eleW,this.eleH),this.tempDraw())},EXMiniChart.prototype.clearGraph=function(){this.isRealMode=!1,this.maxAm=0,this.minAm=Number.MAX_VALUE,this.ctx.clearRect(0,0,this.eleW,this.eleH)},EXMiniChart.prototype.setMode=function(t){this.mode=t,this.calcPosition(this.eleW,this.eleH)},EXMiniChart.prototype.tempDraw=function(){this.canvas.width=this.eleW,this.canvas.height=this.eleH,this.ctx.clearRect(0,0,this.eleW,this.eleH),this.ctx.font="16px '"+this.FONT_FAMILY+"'",this.ctx.fillStyle=this.colorObj.CONT_BACK,this.ctx.fillRect(this.pos.grpLeft,0,this.eleW-this.pos.grpLeft,this.pos.hourSY),this.ctx.rect(this.pos.grpLeft,0,this.eleW-this.pos.grpLeft,this.pos.hourSY),this.ctx.strokeStyle=this.colorObj.CONT_ROUND,this.ctx.lineWidth="2.0",this.ctx.stroke(),this.priceArr=[["",this.pos.grpSY],["",this.pos.grpEY],[0,this.pos.grpEY]],"line"!=this.mode&&(this.ctx.fillStyle=this.colorObj.TEXT_LEFT,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle=this.colorObj.BASELINE,this.fillRoundedRect(0,this.priceArr[2][1]-10,this.pos.grpLeft,20,10),this.ctx.fillStyle=this.colorObj.TEXT_BASE,this.ctx.fillText(this._getDecimalValue(this.priceArr[2][0]),this.pos.txtX,this.priceArr[2][1])),this.ctx.beginPath(),this.ctx.lineWidth="1.0",this.ctx.strokeStyle=this.colorObj.DIVLINE,this.ctx.moveTo(this.pos.grpLeft,this.pos.grpSY),this.ctx.lineTo(this.eleW,this.pos.grpSY),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.webkitImageSmoothingEnabled=!0,this.ctx.moveTo(this.pos.grpLeft,this.pos.grpEY),this.ctx.lineTo(this.eleW,this.pos.grpEY),this.ctx.strokeStyle=this.colorObj.DOWN,this.ctx.lineWidth="3.0",this.ctx.stroke(),this.ctx.closePath()},EXMiniChart.prototype.draw=function(){this.data&&0==this.data.length||(this.ctx.webkitImageSmoothingEnabled=!0,this.canvas.width=this.eleW,this.canvas.height=this.eleH,this.ctx.clearRect(0,0,this.eleW,this.eleH),this.drawBack(),this.drawHLine(),"both"==this.pos.grpTp?this.drawBoth():this.drawOnly())},EXMiniChart.prototype.fillRoundedRect=function(t,i,s,o,h){this.ctx.beginPath(),this.ctx.moveTo(t+h,i),this.ctx.lineTo(t+s-h,i),this.ctx.quadraticCurveTo(t+s,i,t+s,i+h),this.ctx.lineTo(t+s,i+o-h),this.ctx.quadraticCurveTo(t+s,i+o,t+s-h,i+o),this.ctx.lineTo(t+h,i+o),this.ctx.quadraticCurveTo(t,i+o,t,i+o-h),this.ctx.lineTo(t,i+h),this.ctx.quadraticCurveTo(t,i,t+h,i),this.ctx.fill()},EXMiniChart.prototype.drawBack=function(){if(!this.data||0!=this.data.length){this.ctx.font="16px '"+this.FONT_FAMILY+"'",this.ctx.fillStyle=this.colorObj.CONT_BACK,this.ctx.fillRect(this.pos.grpLeft,0,this.eleW-this.pos.grpLeft,this.pos.hourSY),this.ctx.rect(this.pos.grpLeft,0,this.eleW-this.pos.grpLeft,this.pos.hourSY),this.ctx.strokeStyle=this.colorObj.CONT_ROUND,this.ctx.lineWidth="2.0",this.ctx.stroke(),this.ctx.fillStyle=this.colorObj.TEXT_TIME,this.ctx.textAlign="center";for(var t=null,i="",s=1;s<this.timeArr.length-this.timeEnd;s++)i=(t=this.timeArr[s])[1].toString(),this.ctx.fillText(i,this.eleW-t[0]*this.termW,this.pos.hourY);if((t=this.timeArr[0])&&50<t[0]*this.termW&&(i=t[1].toString(),this.ctx.fillText(i,this.eleW-t[0]*this.termW,this.pos.hourY)),this.ctx.fillStyle=this.colorObj.TEXT,this.ctx.textAlign="right",this.ctx.fillText((this.data[0][this.dateKey]+"").substring(0,2)+":"+(this.data[0][this.dateKey]+"").substring(2,4),this.eleW,this.pos.hourY),"line"!=this.mode){this.ctx.fillStyle=this.colorObj.TEXT_LEFT,this.ctx.textAlign="center",this.ctx.textBaseline="middle";for(s=0;s<2;s++)this.ctx.fillText(this._getDecimalValue(this.priceArr[s][0]),this.pos.txtX,this.priceArr[s][1]);this.ctx.fillStyle=this.colorObj.BASELINE,this.fillRoundedRect(0,this.priceArr[2][1]-10,this.pos.grpLeft,20,10),this.ctx.fillStyle=this.colorObj.TEXT_BASE,this.ctx.fillText(this._getDecimalValue(this.priceArr[2][0]),this.pos.txtX,this.priceArr[2][1])}this.ctx.fillStyle=this.colorObj.TEXT_TIME,this.ctx.textAlign="right",this.ctx.textBaseline="top",this.ctx.fillText("5ë¶„",this.eleW-2,2)}},EXMiniChart.prototype.drawHLine=function(){this.ctx.lineWidth="1.0",this.ctx.strokeStyle=this.colorObj.DIVLINE,this.ctx.moveTo(this.pos.grpLeft,this.pos.grpSY),this.ctx.lineTo(this.eleW,this.pos.grpSY),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.moveTo(this.pos.grpLeft,this.pos.grpEY),this.ctx.lineTo(this.eleW,this.pos.grpEY),this.ctx.stroke(),this.ctx.closePath(),this.ctx.beginPath(),this.ctx.strokeStyle=this.colorObj.BASELINE,this.ctx.moveTo(this.pos.grpLeft,this.pos.baseY),this.ctx.lineTo(this.eleW,this.pos.baseY),this.ctx.stroke(),this.ctx.closePath()},EXMiniChart.prototype.drawOnly=function(){this.ctx.lineJoin="bevel",this.ctx.lineCap="round";var t,i,s=this.eleW,o=("up"==this.pos.grpTp?(i=this.colorObj.UP,this.colorObj.UP,this.pos.grpSY,this.pos.baseY,t=this.maxAm):"down"==this.pos.grpTp&&(i=this.colorObj.DOWN,this.colorObj.DOWN,this.pos.grpEY,this.pos.baseY,t=this.basePrice),this.ctx.beginPath(),this.ctx.webkitImageSmoothingEnabled=!0,this.data.length);this.ctx.moveTo(s,this.pos.grpSY+(t-this.data[0][this.valueKey])*this.pos.grpR);for(var h=1;h<o;h++)s-=this.termW,this.ctx.lineTo(s,this.pos.grpSY+(t-this.data[h][this.valueKey])*this.pos.grpR);this.ctx.strokeStyle=i,this.ctx.lineWidth="3.0",this.ctx.stroke(),this.ctx.closePath()},EXMiniChart.prototype.drawBoth=function(){for(var t,i,s,o=this.data.length,h=this.maxAm,e=(this.eleW,this.data[0][this.valueKey]),r=(this.ctx.lineJoin="bevel",this.ctx.lineCap="round",this.ctx.beginPath(),this.ctx.moveTo(this.eleW,this.pos.grpSY+(h-e)*this.pos.grpR),e>=this.basePrice?(t=!0,this.ctx.strokeStyle=this.colorObj.UP):(t=!1,this.ctx.strokeStyle=this.colorObj.DOWN),"",this.ctx.lineWidth="3.0",this.eleW),l=1;l<o;l++)r-=this.termW,i=this.data[l][this.valueKey],t?this.basePrice>i?(s=r+this.termW*(Math.abs(i-this.basePrice)/Math.abs(i-this.data[l-1][this.valueKey])),this.ctx.lineTo(s,this.pos.baseY),this.ctx.strokeStyle=this.colorObj.UP,this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(s,this.pos.baseY),this.ctx.lineTo(r,this.pos.grpSY+(h-i)*this.pos.grpR),this.ctx.strokeStyle=this.colorObj.DOWN,this.ctx.stroke(),t=!1):this.ctx.lineTo(r,this.pos.grpSY+(h-i)*this.pos.grpR):this.basePrice<i?(s=r+this.termW*(Math.abs(i-this.basePrice)/Math.abs(i-this.data[l-1][this.valueKey])),this.ctx.strokeStyle=this.colorObj.DOWN,this.ctx.lineTo(s,this.pos.baseY),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(s,this.pos.baseY),this.ctx.strokeStyle=this.colorObj.UP,this.ctx.lineTo(r,this.pos.grpSY+(h-i)*this.pos.grpR),this.ctx.stroke(),t=!0):this.ctx.lineTo(r,this.pos.grpSY+(h-i)*this.pos.grpR);this.ctx.stroke(),this.ctx.closePath()},EXMiniChart.prototype.drawGradient=function(t,i,s){var o=[],h=(o=26<s.length?[(h=s.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+),\s*(\d\.?\d+)\)$/))[1],h[2],h[3],h[4]]:15<s.length?(h=s.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)\)$/),Util.RGBtoRGBA(h[1],h[2],h[3])):Util.RGBtoRGBA(s),this.ctx.createLinearGradient(0,t,0,i));h.addColorStop(0,"rgba("+o[0]+", "+o[1]+", "+o[2]+", 0.8)"),h.addColorStop(1,"rgba("+o[0]+", "+o[1]+", "+o[2]+", 0.8)"),this.ctx.fillStyle=h,this.ctx.globalAlpha=.5,this.ctx.fill()},EXMiniChart.prototype.getMappingCount=function(){return["Time","Value"]},EXMiniChart.prototype.getQueryData=function(t,i){},EXMiniChart.prototype.setQueryData=function(t,i,s){if(i)if(s.isReal){var o,h,s=t[0];s[i[1]]&&(h=this.data[0][0],(r=3600*(r=s[i[0]]).substr(0,2)+60*r.substr(2,2)+ +r.substr(4,2))<=(h=3600*h.substr(0,2)+60*h.substr(2,2)+ +h.substr(4,2))?this.addNewData([this.data[0][0],s[i[1]]]):(h+=((r=parseInt((r-h)/this.updateTime))+1)*this.updateTime,o=parseInt(h/3600),h%=3600,h=parseInt(h/60),this.addNewData([[o<10?"0"+o:o,h<10?"0"+h:h].join(""),s[i[1]]])))}else{for(var e=new Array,r=null,l=0;l<t.length;l++)8<=(r=7==(r=t[l][i[0]].toString()).length?"0"+r:r).length&&e.push([r.substring(0,4),t[l][i[1]]]);this.setData(e,this.basePrice)}}}();